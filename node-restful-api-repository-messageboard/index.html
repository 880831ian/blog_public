<!DOCTYPE html>
<html lang="zh-tw">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶) - PinYi</title><meta name="description" content="é€™è£¡æ˜¯é—œæ–¼ä¸€å€‹èœé³¥å·¥ç¨‹å¸«æ–œæ§“Youtuberçš„å°å¤©åœ°"><meta property="og:title" content="ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)" />
<meta property="og:description" content="æœ¬æ–‡ç« æ˜¯ä½¿ç”¨ Node.js ä¾†å¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ï¼Œä¸¦ä¸”æœƒä½¿ç”¨ express ä»¥åŠ sequelize (ä½¿ç”¨ Mysql)å¥—ä»¶ã€‚ å»ºè­°å¯ä»¥å…ˆè§€çœ‹ Node.js ä»‹ç´¹ æ–‡ç« ä¾†ç°¡å–®å­¸ç¿’ Node èªè¨€ã€‚ ç¯„ä¾‹ç¨‹å¼é€£çµ é»æˆ‘ ğŸ˜˜" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pin-yi.me/node-restful-api-repository-messageboard/" /><meta property="og:image" content="https://pin-yi.me/node-restful-api-repository-messageboard/featured-image.webp"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-11T11:37:10+08:00" />
<meta property="article:modified_time" content="2022-04-11T15:54:48+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://pin-yi.me/node-restful-api-repository-messageboard/featured-image.webp"/>
<meta name="twitter:title" content="ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)"/>
<meta name="twitter:description" content="æœ¬æ–‡ç« æ˜¯ä½¿ç”¨ Node.js ä¾†å¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ï¼Œä¸¦ä¸”æœƒä½¿ç”¨ express ä»¥åŠ sequelize (ä½¿ç”¨ Mysql)å¥—ä»¶ã€‚ å»ºè­°å¯ä»¥å…ˆè§€çœ‹ Node.js ä»‹ç´¹ æ–‡ç« ä¾†ç°¡å–®å­¸ç¿’ Node èªè¨€ã€‚ ç¯„ä¾‹ç¨‹å¼é€£çµ é»æˆ‘ ğŸ˜˜"/>
<meta name="application-name" content="PinYi">
<meta name="apple-mobile-web-app-title" content="PinYi"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/avatar.webp"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://pin-yi.me/node-restful-api-repository-messageboard/" /><link rel="prev" href="https://pin-yi.me/node/" /><link rel="next" href="https://pin-yi.me/git/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css">
        <link href="https://www.googletagmanager.com" rel="preconnect" crossorigin>
        <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)",
        "inLanguage": "zh-tw",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/pin-yi.me\/node-restful-api-repository-messageboard\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/pin-yi.me\/node-restful-api-repository-messageboard\/featured-image.webp",
                            "width":  1280 ,
                            "height":  300 
                        }],"genre": "posts","keywords": "Node.js, RESTful API, Mysql, Repository, å¯¦ä½œ, ä»‹ç´¹","wordcount":  7458 ,
        "url": "https:\/\/pin-yi.me\/node-restful-api-repository-messageboard\/","datePublished": "2022-04-11T11:37:10+08:00","dateModified": "2022-04-11T15:54:48+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Zhuang,Pin-Yi","logo": "https:\/\/pin-yi.me\/images\/avatar.webp"},"author": {
                "@type": "Person",
                "name": "PinYi"
            },"description": ""
    }
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EK8X0P9SDS"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-EK8X0P9SDS', { 'anonymize_ip': false });
}
</script>
</head><body data-header-desktop="fixed" data-header-mobile="fixed"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="PinYi">PinYi å°å¤©åœ°</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/categories/"> åˆ†é¡ </a><a class="menu-item" href="/tags/"> æ¨™ç±¤ </a><a class="menu-item" href="/sideproject/"> ä½œå“é›† </a><a class="menu-item" href="/categories/youtube/"> YouTube å½±ç‰‡ </a><a class="menu-item" href="/about/"> é—œæ–¼æˆ‘ </a><span class="menu-item delimiter"></span><span class="menu-item language" title="é¸æ“‡èªè¨€">ç¹é«”ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/node-restful-api-repository-messageboard/" selected>ç¹é«”ä¸­æ–‡</option></select>
                    </span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="è«‹è¼¸å…¥è¦æœå°‹çš„æ¨™é¡Œæˆ–æ˜¯å…§å®¹" id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="æœå°‹">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a class="menu-item" href="/index.xml" title="RSS"><i class="fas fa-rss fa-fw" title="RSS"></i> </a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ›ä¸»é¡Œ">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="PinYi">PinYi å°å¤©åœ°</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="è«‹è¼¸å…¥è¦æœå°‹çš„æ¨™é¡Œæˆ–æ˜¯å…§å®¹" id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="æœå°‹">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/categories/" title="">åˆ†é¡</a><a class="menu-item" href="/tags/" title="">æ¨™ç±¤</a><a class="menu-item" href="/sideproject/" title="">ä½œå“é›†</a><a class="menu-item" href="/categories/youtube/" title="">YouTube å½±ç‰‡</a><a class="menu-item" href="/about/" title="">é—œæ–¼æˆ‘</a><div class="menu-item"><a href="/index.xml" title="RSS"><i class="fas fa-rss fa-fw" title="RSS"></i> </a>
                <span>&nbsp;|&nbsp;</span><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ›ä¸»é¡Œ">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div><span class="menu-item language" title="é¸æ“‡èªè¨€">ç¹é«”ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/node-restful-api-repository-messageboard/" selected>ç¹é«”ä¸­æ–‡</option></select>
                </span></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®éŒ„</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/node-restful-api-repository-messageboard/featured-image.webp"
        data-srcset="/node-restful-api-repository-messageboard/featured-image.webp, /node-restful-api-repository-messageboard/featured-image.webp 1.5x, /node-restful-api-repository-messageboard/featured-image.webp 2x"
        data-sizes="auto"
        alt="/node-restful-api-repository-messageboard/featured-image.webp"
        title="/node-restful-api-repository-messageboard/featured-image.webp" /></div><div class="single-card" data-image="true"><h2 class="single-title animated flipInX">ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://pin-yi.me" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>PinYi</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-04-11">2022-04-11</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;ç´„ 7458 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é è¨ˆé–±è®€ 15 åˆ†é˜</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®éŒ„</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#å¯¦ä½œ">å¯¦ä½œ</a>
      <ul>
        <li><a href="#æª”æ¡ˆçµæ§‹">æª”æ¡ˆçµæ§‹</a></li>
        <li><a href="#config">config</a></li>
        <li><a href="#migrations">migrations</a></li>
        <li><a href="#appjs">app.js</a></li>
        <li><a href="#router">router</a></li>
        <li><a href="#middleware">middleware</a></li>
        <li><a href="#models">models</a>
          <ul>
            <li><a href="#indexjs">index.js</a></li>
            <li><a href="#userjs">user.js</a></li>
            <li><a href="#messagejs">message.js</a></li>
            <li><a href="#replyjs">reply.js</a></li>
          </ul>
        </li>
        <li><a href="#controllers">controllers</a>
          <ul>
            <li><a href="#authjs">auth.js</a></li>
            <li><a href="#messagejs-1">message.js</a></li>
            <li><a href="#replyjs-1">reply.js</a></li>
          </ul>
        </li>
        <li><a href="#repositories">repositories</a>
          <ul>
            <li><a href="#authjs-1">auth.js</a></li>
            <li><a href="#messagejs-2">message.js</a></li>
            <li><a href="#replyjs-2">reply.js</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#å¸¸ç”¨æŒ‡ä»¤-sequelize-cli">å¸¸ç”¨æŒ‡ä»¤ (sequelize-cli)</a></li>
    <li><a href="#postman-æ¸¬è©¦">Postman æ¸¬è©¦</a>
      <ul>
        <li><a href="#è¨»å†Š---æˆåŠŸ">è¨»å†Š - æˆåŠŸ</a></li>
        <li><a href="#è¨»å†Š---å¤±æ•—ç„¡è¼¸å…¥">è¨»å†Š - å¤±æ•—(ç„¡è¼¸å…¥)</a></li>
        <li><a href="#è¨»å†Š---å¤±æ•—å·²ç¶“è¨»å†Šé">è¨»å†Š - å¤±æ•—(å·²ç¶“è¨»å†Šé)</a></li>
        <li><a href="#ç™»å…¥---æˆåŠŸ">ç™»å…¥ - æˆåŠŸ</a></li>
        <li><a href="#ç™»å…¥---å¤±æ•—">ç™»å…¥ - å¤±æ•—</a></li>
        <li><a href="#æŸ¥è©¢å…¨éƒ¨ç•™è¨€---æˆåŠŸç„¡è³‡æ–™">æŸ¥è©¢å…¨éƒ¨ç•™è¨€ - æˆåŠŸ(ç„¡è³‡æ–™)</a></li>
        <li><a href="#æŸ¥è©¢å…¨éƒ¨ç•™è¨€---æˆåŠŸæœ‰è³‡æ–™">æŸ¥è©¢å…¨éƒ¨ç•™è¨€ - æˆåŠŸ(æœ‰è³‡æ–™)</a></li>
        <li><a href="#æŸ¥è©¢idç•™è¨€---æˆåŠŸ">æŸ¥è©¢{id}ç•™è¨€ - æˆåŠŸ</a></li>
        <li><a href="#æŸ¥è©¢idç•™è¨€---å¤±æ•—">æŸ¥è©¢{id}ç•™è¨€ - å¤±æ•—</a></li>
        <li><a href="#æ–°å¢ç•™è¨€---æˆåŠŸ">æ–°å¢ç•™è¨€ - æˆåŠŸ</a></li>
        <li><a href="#æ–°å¢ç•™è¨€---å¤±æ•—">æ–°å¢ç•™è¨€ - å¤±æ•—</a></li>
        <li><a href="#ä¿®æ”¹idç•™è¨€---æˆåŠŸ">ä¿®æ”¹{id}ç•™è¨€ - æˆåŠŸ</a></li>
        <li><a href="#ä¿®æ”¹idç•™è¨€---å¤±æ•—">ä¿®æ”¹{id}ç•™è¨€ - å¤±æ•—</a></li>
        <li><a href="#åˆªé™¤idç•™è¨€---æˆåŠŸ">åˆªé™¤{id}ç•™è¨€ - æˆåŠŸ</a></li>
        <li><a href="#åˆªé™¤idç•™è¨€---å¤±æ•—">åˆªé™¤{id}ç•™è¨€ - å¤±æ•—</a></li>
        <li><a href="#æ–°å¢å›è¦†---æˆåŠŸ">æ–°å¢å›è¦† - æˆåŠŸ</a></li>
        <li><a href="#æ–°å¢å›è¦†---å¤±æ•—">æ–°å¢å›è¦† - å¤±æ•—</a></li>
        <li><a href="#ä¿®æ”¹idå›è¦†---æˆåŠŸ">ä¿®æ”¹{id}å›è¦† - æˆåŠŸ</a></li>
        <li><a href="#ä¿®æ”¹idå›è¦†---å¤±æ•—">ä¿®æ”¹{id}å›è¦† - å¤±æ•—</a></li>
        <li><a href="#åˆªé™¤idå›è¦†---æˆåŠŸ">åˆªé™¤{id}å›è¦† - æˆåŠŸ</a></li>
        <li><a href="#åˆªé™¤idå›è¦†---å¤±æ•—">åˆªé™¤{id}å›è¦† - å¤±æ•—</a></li>
      </ul>
    </li>
    <li><a href="#åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><p>æœ¬æ–‡ç« æ˜¯ä½¿ç”¨ Node.js ä¾†å¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ï¼Œä¸¦ä¸”æœƒä½¿ç”¨ express ä»¥åŠ sequelize (ä½¿ç”¨ Mysql)å¥—ä»¶ã€‚</p>
<p>å»ºè­°å¯ä»¥å…ˆè§€çœ‹ <a href="https://pin-yi.me/node/" target="_blank" rel="noopener noreffer">Node.js ä»‹ç´¹</a> æ–‡ç« ä¾†ç°¡å–®å­¸ç¿’ Node èªè¨€ã€‚</p>
<p><a href="https://github.com/880831ian/node-restful-api-repository-messageboard" target="_blank" rel="noopener noreffer">ç¯„ä¾‹ç¨‹å¼é€£çµ é»æˆ‘ ğŸ˜˜
</a></p>
<p>ç‰ˆæœ¬è³‡è¨Š</p>
<ul>
<li>macOSï¼š11.6</li>
<li>nodeï¼šv16.14.2</li>
<li>npmï¼š8.5.0</li>
<li>Mysqlï¼šmysql  Ver 8.0.28 for macos11.6 on x86_64 (Homebrew)
<br></li>
</ul>
<h2 id="å¯¦ä½œ">å¯¦ä½œ</h2>
<h3 id="æª”æ¡ˆçµæ§‹">æª”æ¡ˆçµæ§‹</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">â”œâ”€â”€ app.js
</span></span><span class="line"><span class="cl">â”œâ”€â”€ config
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ config.json
</span></span><span class="line"><span class="cl">â”œâ”€â”€ controllers
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ auth.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ message.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ reply.js
</span></span><span class="line"><span class="cl">â”œâ”€â”€ middleware
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ index.js
</span></span><span class="line"><span class="cl">â”œâ”€â”€ migrations
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ 20220331054531-create-user.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ 20220401093019-create-message.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ 20220404041905-create-reply.js
</span></span><span class="line"><span class="cl">â”œâ”€â”€ models
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ index.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ message.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ reply.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ user.js
</span></span><span class="line"><span class="cl">â”œâ”€â”€ node_modules(ä»¥ä¸‹æª”æ¡ˆçœç•¥)
</span></span><span class="line"><span class="cl">â”œâ”€â”€ package-lock.json
</span></span><span class="line"><span class="cl">â”œâ”€â”€ package.json
</span></span><span class="line"><span class="cl">â”œâ”€â”€ repositories
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ auth.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ message.js
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ reply.js
</span></span><span class="line"><span class="cl">â””â”€â”€ router
</span></span><span class="line"><span class="cl">    â””â”€â”€ index.js
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<p>æˆ‘å€‘ä¾†èªªæ˜ä¸€ä¸‹ä¸Šé¢çš„è³‡æ–™å¤¾ä»¥åŠæª”æ¡ˆå„åˆ¥åŠŸèƒ½èˆ‡ä½œç”¨</p>
<ul>
<li>app.jsï¼šç¨‹å¼çš„å•Ÿå‹•å…¥å£ï¼Œè£¡é¢æœƒæ”¾ç½®æœ‰é—œç¨‹å¼ç³»çµ±éœ€è¦å‘¼å«å“ªäº›å¥—ä»¶ç­‰ç­‰ã€‚</li>
<li>configï¼šæ”¾ç½®è³‡æ–™åº«é€£ç·šè³‡æ–™ (ä½¿ç”¨ sequelize-cli å¥—ä»¶è‡ªå‹•ç”¢ç”Ÿ)ã€‚</li>
<li>controllersï¼šå•†ç”¨é‚è¼¯æ§åˆ¶ã€‚</li>
<li>middlewareï¼šç”¨ä¾†æª¢æŸ¥ç™»å…¥æ¬Šé™ã€‚</li>
<li>migrationsï¼šæ”¾ç½®ç”¢ç”Ÿä¸åŒ Model è³‡æ–™è¡¨ (ä½¿ç”¨ sequelize-cli å¥—ä»¶è‡ªå‹•ç”¢ç”Ÿ)ã€‚</li>
<li>modelsï¼šå®šç¾©è³‡æ–™è¡¨è³‡æ–™å‹æ…‹ (ä½¿ç”¨ sequelize-cli å¥—ä»¶è‡ªå‹•ç”¢ç”Ÿ)ã€‚</li>
<li>node_modulesï¼šæ”¾ç½®ä¸‹è¼‰ä½¿ç”¨çš„å¥—ä»¶ä½ç½®ã€‚</li>
<li>package.json/package-lock.jsonï¼šå°ˆæ¡ˆè³‡è¨Šçš„é‡è¦æª”æ¡ˆ (ä½¿ç”¨ <code>npm init</code> è‡ªå‹•ç”¢ç”Ÿ)ã€‚</li>
<li>repositoriesï¼šè™•ç†èˆ‡è³‡æ–™åº«é€²è¡Œäº¤æ¡ã€‚</li>
<li>routerï¼šè¨­å®šç¶²ç«™ç¶²å€è·¯ç”±ã€‚</li>
</ul>
<br>
<p>ä»¥ä¸‹è©³ç´°èªªæ˜éƒ¨åˆ†ï¼Œåªæœƒèªªæ˜ app.jsã€configã€controllersã€middlewareã€migrationsã€modelsã€repositoriesã€router (ä»‹ç´¹æœƒä¾ç…§ç¨‹å¼æµç¨‹ä¾†ä»‹ç´¹)ã€‚</p>
<br>
<h3 id="config">config</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;development&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;database&#34;</span><span class="p">:</span> <span class="s2">&#34;node&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dialect&#34;</span><span class="p">:</span> <span class="s2">&#34;mysql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dialectOptions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;dateStrings&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;typeCast&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;timezone&#34;</span><span class="p">:</span> <span class="s2">&#34;+08:00&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;database&#34;</span><span class="p">:</span> <span class="s2">&#34;node&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dialect&#34;</span><span class="p">:</span> <span class="s2">&#34;mysql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dialectOptions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;dateStrings&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;typeCast&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;timezone&#34;</span><span class="p">:</span> <span class="s2">&#34;+08:00&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;production&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;root&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;database&#34;</span><span class="p">:</span> <span class="s2">&#34;node&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;host&#34;</span><span class="p">:</span> <span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dialect&#34;</span><span class="p">:</span> <span class="s2">&#34;mysql&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dialectOptions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;dateStrings&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;typeCast&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;timezone&#34;</span><span class="p">:</span> <span class="s2">&#34;+08:00&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”± sequelize-cli å¥—ä»¶è‡ªå‹•ç”¢ç”Ÿï¼Œå¯ä»¥ä¾ç…§ä¸åŒç¨‹å¼ç‹€æ…‹(é–‹ç™¼ developmentã€æ¸¬è©¦ testã€ä¸Šç·š production)ä¾†ä¿®æ”¹é€£ç·šæ™‚çš„åƒæ•¸ã€‚</p>
<br>
<h3 id="migrations">migrations</h3>
<p>æª”æ¡ˆåŸºæœ¬ä¸Šéƒ½é›·åŒï¼Œèˆ‰å…¶ä¸­ä¸€å€‹ç‚ºèªªæ˜ã€‚migrations ä¹Ÿæ˜¯ç”± sequelize-cli å¥—ä»¶è‡ªå‹•ç”¢ç”Ÿï¼Œç›¸é—œæŒ‡ä»¤æœƒçµ±ä¸€æ”¾åœ¨æœ€å¾Œã€‚</p>
<ul>
<li>20220401093019-create-message.js</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="l">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="l">module.exports = {</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">async up(queryInterface, Sequelize) {</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">await queryInterface.createTable(&#34;message&#34;, {</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">allowNull</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">autoIncrement</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">primaryKey</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Sequelize.INTEGER,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">user_id</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">allowNull</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Sequelize.INTEGER,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">references</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;user&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;id&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">allowNull</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Sequelize.STRING,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Sequelize.INTEGER,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">defaultValue</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">createdAt</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">allowNull</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Sequelize.DATE,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">updatedAt</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">allowNull</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Sequelize.DATE,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">deletedAt</span><span class="p">:</span><span class="w"> </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">allowNull</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Sequelize.DATE,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>}<span class="l">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="l">async down(queryInterface, Sequelize) {</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="l">await queryInterface.dropTable(&#34;message&#34;);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>}<span class="l">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€™å€‹æª”æ¡ˆçš„æ ¼å¼ä¹Ÿæ˜¯é€éæŒ‡ä»¤ç”¢ç”Ÿï¼Œæœƒæœ‰ up è·Ÿ downï¼Œup å°±æ˜¯åŸ·è¡ŒæŒ‡ä»¤å¾Œæœƒç”¢ç”Ÿä»€éº¼ï¼Œä¸»è¦éƒ½æœƒæ˜¯æ–°å¢è³‡æ–™è¡¨æˆ–æ˜¯ä¿®æ”¹è³‡æ–™è¡¨ï¼Œdown å‰‡æ˜¯å›å¾©çš„åŠŸèƒ½ï¼Œå¯ä»¥å°‡è³‡æ–™è¡¨çµ¦ dropTable ã€‚æˆ‘å€‘ä¸»è¦æœƒä¿®æ”¹çš„åœ°æ–¹æ˜¯ createTable å…§çš„è³‡æ–™ï¼Œè£¡é¢çš„è³‡æ–™ä»£è¡¨è³‡æ–™è¡¨çš„æ¬„ä½ï¼Œä»¥ä¸‹åˆ—å‡ºå¸¸ç”¨çš„æ ¼å¼ï¼š</p>
<ul>
<li>allowNullï¼šæ˜¯å¦ç‚ºç©ºå€¼</li>
<li>autoIncrementï¼šè‡ªå‹•ç´¯åŠ </li>
<li>primaryKeyï¼šä¸»éµ</li>
<li>typeï¼šè£¡é¢å°±æ”¾æ¬„ä½é¡å‹ï¼Œä¾‹å¦‚ INTEGERã€STRINGã€DATEç­‰ç­‰</li>
</ul>
<h3 id="appjs">app.js</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;express&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">sessions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;express-session&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">8888</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¨­å®š Session
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">oneDay</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sessions</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">secret</span><span class="o">:</span> <span class="s2">&#34;mySecret&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">saveUninitialized</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rolling</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cookie</span><span class="o">:</span> <span class="p">{</span> <span class="nx">maxAge</span><span class="o">:</span> <span class="nx">oneDay</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resave</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¨»å†Šè·¯ç”±
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s2">&#34;/api/v1&#34;</span><span class="p">,</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./router&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æª¢æŸ¥æ˜¯å¦æœ‰tableï¼Œæ²’æœ‰å°±å»ºç«‹
</span></span></span><span class="line"><span class="cl"><span class="c1">// const Message = require(&#34;./models&#34;).message;
</span></span></span><span class="line"><span class="cl"><span class="c1">// const User = require(&#34;./models&#34;).user;
</span></span></span><span class="line"><span class="cl"><span class="c1">// Message.sync();
</span></span></span><span class="line"><span class="cl"><span class="c1">// User.sync();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// é–‹å•Ÿç›£è½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;å•Ÿå‹• Server,Port:&#34;</span> <span class="o">+</span> <span class="nx">port</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å…ˆå¼•å…¥æœƒä½¿ç”¨çš„å¥—ä»¶ (expressï¼šnode web æ¡†æ¶ã€express-sessionï¼šsession å¥—ä»¶)</li>
<li>è¨­å®š app ç‚º express() å¯¦ä¾‹ï¼Œport ç‚º 8888ã€‚</li>
<li>è¨­å®š session å¤±æ•ˆæ™‚é–“ã€åç¨±ç­‰è¨­å®šã€‚
<ul>
<li>secret(å¿…è¦)ï¼šç”¨ä¾†ç°½ç«  sessionID çš„cookie, å¯ä»¥æ˜¯ä¸€secretå­—ä¸²æˆ–æ˜¯å¤šå€‹secretçµ„æˆçš„ä¸€å€‹é™£åˆ—ã€‚</li>
<li>nameï¼šåœ¨responseä¸­ï¼Œè¨­å®šçš„ sessionID cookie åå­—ã€‚é è¨­æ˜¯ connect.sidã€‚</li>
<li>saveUninitializedï¼šå¼·åˆ¶å°‡æœªåˆå§‹åŒ–çš„sessionå­˜å› session storeï¼Œæœªåˆå§‹åŒ–çš„æ„æ€æ˜¯å®ƒæ˜¯æ–°çš„è€Œä¸”æœªè¢«ä¿®æ”¹ã€‚</li>
<li>rollingï¼šå¼·åˆ¶åœ¨æ¯ä¸€æ¬¡å›æ‡‰æ™‚ï¼Œé‡æ–°è¨­ç½®ä¸€å€‹sessionID cookieã€‚</li>
<li>cookieï¼šè¨­å®šsessionID çš„cookieç›¸é—œé¸é …ã€‚</li>
<li>resaveï¼šå¼·åˆ¶å°‡sessionå­˜å› session store, å³ä½¿å®ƒæ²’æœ‰è¢«ä¿®æ”¹ã€‚</li>
</ul>
</li>
<li>è¨»å†Šè·¯ç”±ï¼Œé€£ç·š <code>http://127.0.0.1/api/v1</code> å¾Œé¢æœƒå°å‘ router æª”æ¡ˆã€‚</li>
<li>è¨»è§£éƒ¨åˆ†ç‚ºå¯ä»¥æ¯æ¬¡å•Ÿå‹•å¾Œå…ˆæª¢æŸ¥æ˜¯å¦æœ‰tableï¼Œæ²’æœ‰å°±å»ºç«‹ã€‚</li>
<li>é–‹å•Ÿ port(8888) ç›£è½ã€‚</li>
</ol>
<br>
<h3 id="router">router</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;express&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">middleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../middleware&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">router</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">register</span><span class="p">,</span> <span class="nx">login</span><span class="p">,</span> <span class="nx">lojsut</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../controllers/auth&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">getAllMessage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">getMessage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">createMessage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">updateMessage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">deleteMessage</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../controllers/message&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">createReply</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">updateReply</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">deleteReply</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../controllers/reply&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¨»å†Šã€ç™»å…¥ã€ç™»å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/register&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="nx">register</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/login&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="nx">login</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/lojsut&#34;</span><span class="p">,</span> <span class="nx">lojsut</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æŸ¥è©¢ç•™è¨€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;/message&#34;</span><span class="p">,</span> <span class="nx">getAllMessage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;/message/:message_id&#34;</span><span class="p">,</span> <span class="nx">getMessage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//éœ€è¦é©—è­‰æ‰å¯ä»¥ä½¿ç”¨ï¼ˆæ–°å¢ç•™è¨€ã€ä¿®æ”¹ç•™è¨€ã€åˆªé™¤ç•™è¨€ã€æ–°å¢ç•™è¨€å›è¦†ã€ä¿®æ”¹ç•™è¨€å›è¦†ã€åˆªé™¤ç•™è¨€å›è¦†ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">router</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">middleware</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/message&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="nx">createMessage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s2">&#34;/message/:message_id&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="nx">updateMessage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s2">&#34;/message/:message_id&#34;</span><span class="p">,</span> <span class="nx">deleteMessage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">&#34;/message/:message_id&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="nx">createReply</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s2">&#34;/message/:message_id/:reply_id&#34;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">(),</span> <span class="nx">updateReply</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">router</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s2">&#34;/message/:message_id/:reply_id&#34;</span><span class="p">,</span> <span class="nx">deleteReply</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">router</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¨­å®šè·¯ç”±ï¼Œåˆ†åˆ¥æ˜¯è¨»å†Šã€ç™»å…¥ã€ç™»å‡ºã€æ–°å¢ç•™è¨€ã€æŸ¥è©¢å…¨éƒ¨ç•™è¨€ã€æŸ¥è©¢ {id} ç•™è¨€ã€ä¿®æ”¹ {id} ç•™è¨€ã€åˆªé™¤ {id} ç•™è¨€ï¼Œé€£æ¥åˆ°ä¸åŒçš„ controller functionã€‚express.json() å‡½æ•¸æ˜¯ç‚ºäº†è¦è®“ body-parser è§£æå¸¶æœ‰ JSON å‚³å…¥å¾Œé¢çš„ controllerï¼Œå…¶ä¸­æ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯å› ç‚ºæ–°å¢ç•™è¨€ã€ä¿®æ”¹ç•™è¨€ã€åˆªé™¤ç•™è¨€ã€æ–°å¢ç•™è¨€å›è¦†ã€ä¿®æ”¹ç•™è¨€å›è¦†ã€åˆªé™¤ç•™è¨€å›è¦†éœ€è¦ç™»å…¥å¾Œæ‰å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥å¤šä¸€å€‹ middleware ä¾†é©—è­‰æ˜¯å¦ç™»å…¥ã€‚</p>
<br>
<h3 id="middleware">middleware</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userid</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">401</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;ç”¨æˆ¶éœ€è¦èªè­‰&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ session ä¾†é©—è­‰æ˜¯å¦æœ‰ç™»å…¥ã€‚</p>
<br>
<h3 id="models">models</h3>
<p>æœƒæ”¾ç½®èˆ‡è³‡æ–™è¡¨è³‡æ–™å‹æ…‹æœ‰é—œçš„è³‡è¨Šï¼Œå…¶ä¸­ index.js æ˜¯ç”± sequelize-cli å¥—ä»¶è‡ªå‹•ç”¢ç”Ÿï¼Œç”¨ä¾†è®€å–ç›®å‰å¯«åœ¨ config çš„é€£ç·šè¨­å®šæª”ç­‰è³‡è¨Šã€‚</p>
<h4 id="indexjs">index.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;fs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Sequelize</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sequelize&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">basename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">__filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">||</span> <span class="s2">&#34;development&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&#34;/../config/config.json&#34;</span><span class="p">)[</span><span class="nx">env</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">sequelize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">use_env_variable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sequelize</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="nx">config</span><span class="p">.</span><span class="nx">use_env_variable</span><span class="p">],</span> <span class="nx">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sequelize</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span><span class="p">.</span><span class="nx">database</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">config</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">file</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">file</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">file</span> <span class="o">!==</span> <span class="nx">basename</span> <span class="o">&amp;&amp;</span> <span class="nx">file</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&#34;.js&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">file</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">model</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">file</span><span class="p">))(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sequelize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">Sequelize</span><span class="p">.</span><span class="nx">DataTypes</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">db</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">model</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">db</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">modelName</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">db</span><span class="p">[</span><span class="nx">modelName</span><span class="p">].</span><span class="nx">associate</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">db</span><span class="p">[</span><span class="nx">modelName</span><span class="p">].</span><span class="nx">associate</span><span class="p">(</span><span class="nx">db</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nx">sequelize</span> <span class="o">=</span> <span class="nx">sequelize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">.</span><span class="nx">Sequelize</span> <span class="o">=</span> <span class="nx">Sequelize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">db</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h4 id="userjs">user.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sequelize&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">class</span> <span class="nx">user</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">static</span> <span class="nx">associate</span><span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">user</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">foreignKey</span><span class="o">:</span> <span class="s2">&#34;user_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">user</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">username</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">unique</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">password</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sequelize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">paranoid</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">freezeTableName</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">modelName</span><span class="o">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤ç‚º user è³‡æ–™è¡¨çš„æ¬„ä½è³‡æ–™ï¼Œæœ‰é è¨­çš„ init åˆå§‹åŒ–ï¼Œæ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯å¦‚æœæœ‰ç”¨åˆ°é—œè¯æ€§çš„å¤–éµç­‰ç­‰è¦è¨˜å¾—åœ¨ associate åšè¨­å®šï¼Œ<code>user.hasMany(models.message,{foreignKey: &quot;user_id&quot;,})</code> ä»£è¡¨ user é€™å¼µè¡¨å¯ä»¥æœ‰å¾ˆå¤šå€‹ messageï¼Œå…¶ message å¤–éµæ˜¯ user_idã€‚</p>
<ul>
<li>paranoidï¼šä»£è¡¨æœƒåŸ·è¡Œè»Ÿåˆªé™¤è€Œä¸æ˜¯ç¡¬åˆªé™¤ï¼Œä½†å¿…é ˆè¦å¤šä¸€å€‹ <code>deletedAt</code> ä¾†å­˜æ”¾è»Ÿåˆªé™¤æ™‚é–“ã€‚</li>
<li>freezeTableNameï¼šå› ç‚º sequelize æœƒè‡ªå‹•å†ç”¢ç”Ÿè³‡æ–™è¡¨æ™‚åŠ ä¸Šè¤‡æ•¸ï¼Œå¦‚æœä¸æƒ³è¦å°±å¿…é ˆä½¿ç”¨å®ƒè®“ sequelize ä¸æœƒè‡ªå‹•åŠ å…¥ s (è¤‡æ•¸)ã€‚</li>
<li>modelNameï¼šæ­¤ model åç¨±ã€‚</li>
</ul>
<br>
<h4 id="messagejs">message.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sequelize&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">class</span> <span class="nx">message</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">static</span> <span class="nx">associate</span><span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">hasMany</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">reply</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">foreignKey</span><span class="o">:</span> <span class="s2">&#34;message_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">foreignKey</span><span class="o">:</span> <span class="s2">&#34;user_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">message</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">content</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">version</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sequelize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">paranoid</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">freezeTableName</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">modelName</span><span class="o">:</span> <span class="s2">&#34;message&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤ç‚º message è³‡æ–™è¡¨çš„æ¬„ä½è³‡æ–™ï¼Œassociate è¨­å®šæœ‰ <code>message.hasMany(models.reply,{foreignKey: &quot;message_id&quot;,})</code> ä»£è¡¨ message é€™å¼µè¡¨å¯ä»¥æœ‰å¾ˆå¤šå€‹ replyï¼Œå…¶ reply å¤–éµæ˜¯ message_idã€‚ä»¥åŠ <code>message.belongsTo(models.user, {foreignKey: &quot;user_id&quot;,});</code> ä»£è¡¨ message å­˜åœ¨ä¸€å°ä¸€çš„é—œä¿‚ï¼Œå¤–éµæ˜¯ user_idã€‚</p>
<br>
<h4 id="replyjs">reply.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="s2">&#34;use strict&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">Model</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;sequelize&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="nx">sequelize</span><span class="p">,</span> <span class="nx">DataTypes</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">class</span> <span class="nx">reply</span> <span class="kr">extends</span> <span class="nx">Model</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">static</span> <span class="nx">associate</span><span class="p">(</span><span class="nx">models</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">reply</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">foreignKey</span><span class="o">:</span> <span class="s2">&#34;message_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">reply</span><span class="p">.</span><span class="nx">belongsTo</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">foreignKey</span><span class="o">:</span> <span class="s2">&#34;user_id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">reply</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message_id</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">user_id</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">INTEGER</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">content</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">allowNull</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">version</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="nx">DataTypes</span><span class="p">.</span><span class="nx">STRING</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sequelize</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">paranoid</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">freezeTableName</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">modelName</span><span class="o">:</span> <span class="s2">&#34;reply&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">reply</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ­¤ç‚º reply è³‡æ–™è¡¨çš„æ¬„ä½è³‡æ–™ï¼Œassociate è¨­å®šæœ‰<code>reply.belongsTo(models.message, {foreignKey: &quot;message_id&quot;,});</code> ä»£è¡¨ reply å­˜åœ¨ä¸€å°ä¸€çš„é—œä¿‚ï¼Œå¤–éµæ˜¯ message_idï¼Œä»¥åŠ <code>reply.belongsTo(models.user, {foreignKey: &quot;user_id&quot;,});</code> ä»£è¡¨ reply å­˜åœ¨ä¸€å°ä¸€çš„é—œä¿‚ï¼Œå¤–éµæ˜¯ user_idã€‚</p>
<br>
<h3 id="controllers">controllers</h3>
<p>æˆ‘å€‘éµå¾ª MVC çš„è¨­è¨ˆè¦ç¯„ï¼Œæ‰€æœ‰çš„å•†ç”¨é‚è¼¯éƒ½æœƒæ”¾åœ¨ controller å…§ï¼Œrepository åªè² è²¬èˆ‡è³‡æ–™åº«é€²è¡Œäº¤æ¡ã€‚</p>
<h4 id="authjs">auth.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Auth</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../repositories/auth&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;bcrypt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¨»å†Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">register</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span> <span class="o">||</span> <span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&#34;æ²’æœ‰æ­£ç¢ºè¼¸å…¥å¸³è™Ÿæˆ–å¯†ç¢¼&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">salt</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">genSalt</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">bcrypt_password</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="nx">salt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Auth</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">bcrypt_password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&#34;usernameå·²å­˜åœ¨&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">user</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç™»å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">login</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span> <span class="o">||</span> <span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&#34;æ²’æœ‰æ­£ç¢ºè¼¸å…¥å¸³è™Ÿæˆ–å¯†ç¢¼&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Auth</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&#34;å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">session</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">session</span><span class="p">.</span><span class="nx">userid</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&#34;ç™»å…¥æˆåŠŸ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç™»å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">logout</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">session</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">session</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">user</span><span class="o">:</span> <span class="s2">&#34;ç™»å‡ºæˆåŠŸ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">register</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">login</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">logout</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸»è¦æœ‰3 å€‹éƒ¨ä»½ï¼Œè¨»å†Šã€ç™»å…¥ã€ç™»å‡ºï¼š</p>
<ul>
<li>è¨»å†Šï¼šæœƒå…ˆé©—è­‰æ˜¯å¦æ­£ç¢ºè¼¸å…¥è³‡æ–™(åŒ…å«æ¬„ä½æ˜¯å¦éŒ¯èª¤ç­‰)ï¼Œå¦‚æœæœ‰éŒ¯ï¼Œå°±æœƒå›æ‡‰ 400 ä»¥åŠæ²’æœ‰æ­£ç¢ºè¼¸å…¥å¸³è™Ÿæˆ–å¯†ç¢¼ã€‚æ¥ä¸‹ä¾†æœƒä½¿ç”¨åˆ° <code>bcrypt</code> ä¾†å¹«å¯†ç¢¼é€²è¡ŒåŠ å¯†è™•ç†ï¼Œå†æŠŠåŠ å¯†å¾Œçš„å¯†ç¢¼ä»¥åŠå¸³è™Ÿä¸Ÿåˆ° Auth.register repository ä¾†é€²è¡Œè³‡æ–™åº«çš„å­˜å–ï¼Œå¦‚æœéŒ¯èª¤æœƒå›æ‡‰ 400 ä»¥åŠ username å·²å­˜åœ¨ï¼ŒæˆåŠŸæœƒå›æ‡‰ 201 ä»¥åŠæ–°å¢çš„å¸³è™Ÿè³‡è¨Šã€‚</li>
<li>ç™»å…¥ï¼šä¸€æ¨£æœƒå…ˆæª¢æŸ¥è¼¸å…¥è³‡æ–™ï¼Œæ¥è‘—æŠŠè³‡æ–™ä¸Ÿåˆ° Auth.login repository ä¾†é€²è¡Œè³‡æ–™åº«çš„é©—è­‰ï¼Œå¦‚æœéŒ¯èª¤æœƒå›æ‡‰ 400 ä»¥åŠå¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼ŒæˆåŠŸæœƒå›æ‡‰ 200 ä»¥åŠç™»å‡ºæˆåŠŸã€‚</li>
<li>ç™»å‡ºï¼šå°‡ session çµ¦æ¸…é™¤ï¼Œç„¶å¾Œå›æ‡‰ 200 ä»¥åŠç™»å‡ºæˆåŠŸã€‚</li>
</ul>
<br>
<h4 id="messagejs-1">message.js</h4>
<p>(ç”±æ–¼å…§å®¹è¼ƒå¤šï¼Œæ‰€ä»¥ä¾ç…§åŠŸèƒ½æ‹†åˆ†å¾Œèªªæ˜)</p>
<p><strong>æŸ¥è©¢ç•™è¨€åŠŸèƒ½</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../repositories/message&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Reply</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../repositories/reply&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æŸ¥è©¢æ‰€æœ‰ç•™è¨€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getAllMessage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">message</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">getAll</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//æŸ¥è©¢{id}ç•™è¨€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">getMessage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">message</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ‰¾ä¸åˆ°ç•™è¨€&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆè¼‰å…¥è¦ä½¿ç”¨çš„ repository ï¼ŒæŸ¥è©¢æ‰€æœ‰ç•™è¨€æœƒä½¿ç”¨ Message.getAll() repository ä¾†é€²è¡Œè³‡æ–™åº«çš„è®€å–ï¼Œæœƒå›æ‡‰ 200 ä»¥åŠæŸ¥è©¢å…§å®¹ï¼Œè‹¥æ˜¯å°šæœªæœ‰ç•™è¨€å‰‡æœƒé¡¯ç¤ºç©ºé™£åˆ—ã€‚æŸ¥è©¢{id}ç•™è¨€æœƒå°‡ <code>req.params.message_id</code> ä¸Ÿåˆ° Message.get repository ä¾†é€²è¡Œè³‡æ–™åº«çš„è®€å–ï¼Œå¦‚æœéŒ¯èª¤æœƒå›æ‡‰ 404 ä»¥åŠ æ‰¾ä¸åˆ°ç•™è¨€ï¼ŒæˆåŠŸæœƒå›æ‡‰ 200 ä»¥åŠæŸ¥è©¢å…§å®¹ã€‚</p>
<br>
<p><strong>æ–°å¢ç•™è¨€åŠŸèƒ½</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//æ–°å¢ç•™è¨€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">createMessage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ²’æœ‰è¼¸å…¥å…§å®¹æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">message</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">message</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ–°å¢ç•™è¨€æœƒå…ˆæª¢æŸ¥è¼¸å…¥å…§å®¹æ˜¯å¦ç‚ºç©ºä»¥åŠä¸èƒ½å¤§æ–¼20å€‹å­—å…ƒï¼Œå¦‚æœéŒ¯èª¤å°±å›æ‡‰ 400 ä»¥åŠæ²’æœ‰è¼¸å…¥å…§å®¹æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒï¼Œå†å°‡ <code>req.session.userid</code>ã€<code>req.body.content</code> ä¸Ÿåˆ° Message.create repository ä¾†é€²è¡Œè³‡æ–™åº«çš„å­˜å–ï¼ŒæˆåŠŸæœƒå›æ‡‰ 201 ä»¥åŠæ–°å¢çš„ç•™è¨€ã€‚</p>
<br>
<p><strong>ä¿®æ”¹ç•™è¨€åŠŸèƒ½</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//ä¿®æ”¹ç•™è¨€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">updateMessage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">message</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ‰¾ä¸åˆ°ç•™è¨€&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ²’æœ‰è¼¸å…¥å…§å®¹æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">message</span><span class="p">[</span><span class="s2">&#34;version&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span> <span class="o">==</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;ä¿®æ”¹ç•™è¨€å¤±æ•—&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;ä¿®æ”¹ç•™è¨€æˆåŠŸ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹ç•™è¨€å› ç‚ºéœ€è¦å…ˆå¾è³‡æ–™ä¸­å–å¾— <code>version</code> ä¾†æª¢æŸ¥æ¨‚è§€é–ï¼Œæ‰€ä»¥æœƒå…ˆå°‡ <code>req.params.message_id</code> ä¸Ÿåˆ° Message.get repository ä¾†é€²è¡Œè³‡æ–™åº«çš„æŸ¥è©¢ï¼ŒéŒ¯èª¤æœƒå›æ‡‰ 404 ä»¥åŠæ‰¾ä¸åˆ°ç•™è¨€ã€‚
å…ˆæª¢æŸ¥è¼¸å…¥å…§å®¹æ˜¯å¦ç‚ºç©ºä»¥åŠä¸èƒ½å¤§æ–¼20å€‹å­—å…ƒï¼Œå¦‚æœéŒ¯èª¤å°±å›æ‡‰ 400 ä»¥åŠæ²’æœ‰è¼¸å…¥å…§å®¹æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒï¼Œå†å°‡ <code>req.params.message_id</code>ã€<code>req.session.userid</code>ã€<code>req.body.content</code>ã€<code>message[&quot;version&quot;]</code> ä¸Ÿåˆ° Message.update repository ä¾†é€²è¡Œè³‡æ–™åº«çš„æ›´æ–°ï¼ŒéŒ¯èª¤æœƒå›æ‡‰ 400 ä»¥åŠä¿®æ”¹ç•™è¨€å¤±æ•—ï¼ŒæˆåŠŸæœƒå›æ‡‰ 200 ä»¥åŠä¿®æ”¹ç•™è¨€æˆåŠŸã€‚</p>
<br>
<p><strong>åˆªé™¤ç•™è¨€åŠŸèƒ½</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//åˆªé™¤ç•™è¨€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">deleteMessage</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userid</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;åˆªé™¤ç•™è¨€å¤±æ•—&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// åˆªé™¤ç•™è¨€æ™‚åŒæ­¥åˆªé™¤æ‰€æœ‰å›è¦†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">deleteMessage</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;åˆªé™¤ç•™è¨€æˆåŠŸ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆªé™¤ç•™è¨€æœƒå°‡ <code>req.params.message_id</code>ã€<code>req.session.userid</code> ä¸Ÿåˆ° Message.delete repository ä¾†é€²è¡Œè³‡æ–™åº«çš„è»Ÿåˆªé™¤ï¼ŒéŒ¯èª¤æœƒå›æ‡‰ 400 ä»¥åŠåˆªé™¤ç•™è¨€å¤±æ•—ï¼Œå› ç‚ºæˆ‘å€‘åˆªé™¤ç•™è¨€å¾Œï¼Œä¸èƒ½åœ¨å°è©²ç•™è¨€é€²è¡Œå›è¦†çš„ä»»ä½•åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸€åŒè»Ÿåˆªé™¤æ‰€æœ‰çš„å›è¦†ï¼ŒæˆåŠŸå¾Œæœƒå›æ‡‰ 204 ä»¥åŠåˆªé™¤ç•™è¨€æˆåŠŸã€‚</p>
<br>
<h4 id="replyjs-1">reply.js</h4>
<p>(ç”±æ–¼å…§å®¹è¼ƒå¤šï¼Œæ‰€ä»¥ä¾ç…§åŠŸèƒ½æ‹†åˆ†å¾Œèªªæ˜)</p>
<p><strong>æ–°å¢å›è¦†åŠŸèƒ½</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Reply</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../repositories/reply&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//æ–°å¢å›è¦†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">createReply</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ²’æœ‰è¼¸å…¥å›è¦†æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">!</span><span class="p">(</span><span class="nx">reply</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ–°å¢å›è¦†å¤±æ•—&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">reply</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…ˆè¼‰å…¥è¦ä½¿ç”¨çš„ repositoryï¼Œæ–°å¢å›è¦†å…ˆæª¢æŸ¥è¼¸å…¥å…§å®¹æ˜¯å¦ç‚ºç©ºä»¥åŠä¸èƒ½å¤§æ–¼20å€‹å­—å…ƒï¼Œå¦‚æœéŒ¯èª¤å°±å›æ‡‰ 400 ä»¥åŠæ²’æœ‰è¼¸å…¥å…§å®¹æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒï¼Œå†å°‡ <code>req.params.message_id</code>ã€<code>req.session.userid</code>ã€<code>req.body.content</code> ä¸Ÿåˆ° Reply.create repository ä¾†é€²è¡Œè³‡æ–™åº«çš„å­˜å–ï¼ŒéŒ¯èª¤æœƒå›æ‡‰ 400 ä»¥åŠæ–°å¢ç•™è¨€å¤±æ•—ï¼ŒæˆåŠŸæœƒå›æ‡‰ 201 ä»¥åŠæ–°å¢å›è¦†å…§å®¹ã€‚</p>
<br>
<p><strong>ä¿®æ”¹å›è¦†åŠŸèƒ½</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//ä¿®æ”¹å›è¦†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">updateReply</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">reply</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">reply_id</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">)))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ‰¾ä¸åˆ°å›è¦†&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;æ²’æœ‰è¼¸å…¥å›è¦†æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">reply_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">reply</span><span class="p">[</span><span class="s2">&#34;version&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span> <span class="o">==</span> <span class="s2">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;ä¿®æ”¹å›è¦†å¤±æ•—&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;ä¿®æ”¹å›è¦†æˆåŠŸ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹ç•™è¨€å› ç‚ºéœ€è¦å…ˆå¾è³‡æ–™ä¸­å–å¾— <code>version</code> ä¾†æª¢æŸ¥æ¨‚è§€é–ï¼Œæ‰€ä»¥æœƒå…ˆå°‡ <code>req.params.reply_id</code>ã€<code>req.params.message_id</code> ä¸Ÿåˆ° Reply.get repository ä¾†é€²è¡Œè³‡æ–™åº«çš„æŸ¥è©¢ï¼ŒéŒ¯èª¤æœƒå›æ‡‰ 404 ä»¥åŠæ‰¾ä¸åˆ°ç•™è¨€ã€‚
å…ˆæª¢æŸ¥è¼¸å…¥å…§å®¹æ˜¯å¦ç‚ºç©ºä»¥åŠä¸èƒ½å¤§æ–¼20å€‹å­—å…ƒï¼Œå¦‚æœéŒ¯èª¤å°±å›æ‡‰ 400 ä»¥åŠæ²’æœ‰è¼¸å…¥å…§å®¹æˆ–é•·åº¦è¶…é20å€‹å­—å…ƒï¼Œå†å°‡ <code>req.params.reply_id </code>ã€<code>req.params.message_id</code>ã€<code>req.session.userid</code>ã€<code>req.body.content</code>ã€<code>reply[&quot;version&quot;]</code> ä¸Ÿåˆ° Reply.update repository ä¾†é€²è¡Œè³‡æ–™åº«çš„æ›´æ–°ï¼ŒéŒ¯èª¤æœƒå›æ‡‰ 400 ä»¥åŠä¿®æ”¹å›è¦†å¤±æ•—ï¼ŒæˆåŠŸæœƒå›æ‡‰ 200 ä»¥åŠä¿®æ”¹å›è¦†æˆåŠŸã€‚</p>
<br>
<p><strong>åˆªé™¤å›è¦†åŠŸèƒ½</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//åˆªé™¤å›è¦†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">deleteReply</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">!</span><span class="p">(</span><span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">reply_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">userid</span>
</span></span><span class="line"><span class="cl">    <span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;åˆªé™¤å›è¦†å¤±æ•—&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">204</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="nx">message</span><span class="o">:</span> <span class="s2">&#34;åˆªé™¤å›è¦†æˆåŠŸ&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆªé™¤å›è¦†æœƒå°‡ <code>req.params.reply_id</code>ã€<code>req.params.message_id</code>ã€<code>req.session.userid</code> ä¸Ÿåˆ° Reply.delete repository ä¾†é€²è¡Œè³‡æ–™åº«çš„è»Ÿåˆªé™¤ï¼ŒéŒ¯èª¤æœƒå›æ‡‰ 400 ä»¥åŠåˆªé™¤å›è¦†å¤±æ•—ï¼ŒæˆåŠŸå¾Œæœƒå›æ‡‰ 204 ä»¥åŠåˆªé™¤å›è¦†æˆåŠŸã€‚</p>
<br>
<h3 id="repositories">repositories</h3>
<p>æ­¤æœƒæ”¾ç½®èˆ‡è³‡æ–™åº«é€²è¡Œäº¤æ¡çš„ç¨‹å¼ã€‚</p>
<h4 id="authjs-1">auth.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../models&#34;</span><span class="p">).</span><span class="nx">user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">bcrypt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;bcrypt&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">auth</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// è¨»å†Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">async</span> <span class="nx">register</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">bcrypt_password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">findOrCreate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="nx">bcrypt_password</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç™»å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">async</span> <span class="nx">login</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">User</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span> <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span> <span class="p">}</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">(</span><span class="kr">await</span> <span class="nx">bcrypt</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">))</span> <span class="o">?</span> <span class="nx">user</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">auth</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>auth å…§ä¸»è¦æœ‰å…©å€‹èˆ‡è³‡æ–™åº«é€²è¡Œäº’å‹•ï¼Œåˆ†åˆ¥æ˜¯ï¼Œè¨»å†Šä»¥åŠç™»å…¥ï¼Œè¨»å†Šæœƒå°‡å‚³å…¥çš„å¸³è™Ÿä»¥åŠåŠ å¯†éå¾Œå¯†ç¢¼ä½¿ç”¨ <code>User.findOrCreate</code> ä¾†é€²è¡ŒæŸ¥è©¢æˆ–æ–°å¢ï¼Œå¦‚æœå¸³è™Ÿä¸å­˜åœ¨æ‰æœƒé€²è¡Œæ–°å¢å‹•ä½œã€‚ç™»å…¥æœƒå°‡å‚³å…¥çš„å¸³è™ŸåŠå¯†ç¢¼ä½¿ç”¨ <code>User.findOne</code> ä¾†æª¢æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å†æª¢æŸ¥å¯†ç¢¼èˆ‡è³‡æ–™åº«æ˜¯å¦æ­£ç¢ºã€‚</p>
<br>
<h4 id="messagejs-2">message.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../models&#34;</span><span class="p">).</span><span class="nx">message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Reply</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../models&#34;</span><span class="p">).</span><span class="nx">reply</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">repository</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">getAll</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">findAll</span><span class="p">({</span> <span class="nx">include</span><span class="o">:</span> <span class="p">{</span> <span class="nx">model</span><span class="o">:</span> <span class="nx">Reply</span> <span class="p">}</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">get</span><span class="p">(</span><span class="nx">message_id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">include</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">model</span><span class="o">:</span> <span class="nx">Reply</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">message_id</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">create</span><span class="p">(</span><span class="nx">user_id</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="nx">user_id</span><span class="o">:</span> <span class="nx">user_id</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">update</span><span class="p">(</span><span class="nx">message_id</span><span class="p">,</span> <span class="nx">user_id</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">version</span><span class="o">:</span> <span class="nx">version</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">user_id</span><span class="o">:</span> <span class="nx">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">version</span><span class="o">:</span> <span class="nx">version</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">message_id</span><span class="p">,</span> <span class="nx">user_id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">destroy</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">message_id</span><span class="p">,</span> <span class="nx">user_id</span><span class="o">:</span> <span class="nx">user_id</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">repository</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>message.js è£¡é¢æœ‰æœƒæŸ¥è©¢å…¨éƒ¨ç•™è¨€ã€æŸ¥è©¢{id}ç•™è¨€ã€æ–°å¢ç•™è¨€ã€ä¿®æ”¹{id}ç•™è¨€ã€åˆªé™¤{id}ç•™è¨€ç­‰ï¼Œä»¥ä¸‹æœƒèªªæ˜å„åˆ¥è² è²¬åŠŸç”¨ï¼š</p>
<ul>
<li>æŸ¥è©¢å…¨éƒ¨ç•™è¨€ getAll()ï¼šä½¿ç”¨ <code>Message.findAll</code> ä¾†é¡¯ç¤ºæŸ¥è©¢çµæœï¼Œä¸¦ä¸” include model Reply å›è¦†å…§å®¹ã€‚</li>
<li>æŸ¥è©¢{id}ç•™è¨€ get()ï¼šä½¿ç”¨ <code>Message.findOne</code> æŸ¥è©¢ message.id ç­‰æ–¼ message_id çš„çµæœï¼Œä¸¦ä¸” include model Reply å›è¦†å…§å®¹ã€‚</li>
<li>æ–°å¢ç•™è¨€ create()ï¼šä½¿ç”¨ <code>Message.create</code> æ–°å¢ message.user_id ä»¥åŠ message.contentã€‚</li>
<li>ä¿®æ”¹{id}ç•™è¨€ update()ï¼šä½¿ç”¨ <code>Message.update</code> æ›´æ–° content ä»¥åŠ versionï¼Œä¸” message.id è¦ç­‰æ–¼ message_id åŠ message.user_id ç­‰æ–¼ user_id åŠ message.version ç­‰æ–¼ versionã€‚</li>
<li>åˆªé™¤{id}ç•™è¨€ delete()ï¼šä½¿ç”¨ <code>Message.destroy</code> åˆªé™¤ç¬¦åˆ message.id ç­‰æ–¼ message_id åŠ message.user_id ç­‰æ–¼ user_idã€‚
<br></li>
</ul>
<h4 id="replyjs-2">reply.js</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Message</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../models&#34;</span><span class="p">).</span><span class="nx">message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Reply</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;../models&#34;</span><span class="p">).</span><span class="nx">reply</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">reply</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">get</span><span class="p">(</span><span class="nx">reply_id</span><span class="p">,</span> <span class="nx">message_id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">reply_id</span><span class="p">,</span> <span class="nx">message_id</span><span class="o">:</span> <span class="nx">message_id</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">create</span><span class="p">(</span><span class="nx">message_id</span><span class="p">,</span> <span class="nx">user_id</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">is_exist</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">findOne</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">message_id</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">is_exist</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message_id</span><span class="o">:</span> <span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">user_id</span><span class="o">:</span> <span class="nx">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">update</span><span class="p">(</span><span class="nx">reply_id</span><span class="p">,</span> <span class="nx">message_id</span><span class="p">,</span> <span class="nx">user_id</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">version</span><span class="o">:</span> <span class="nx">version</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="nx">reply_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">message_id</span><span class="o">:</span> <span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">user_id</span><span class="o">:</span> <span class="nx">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">version</span><span class="o">:</span> <span class="nx">version</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="k">delete</span><span class="p">(</span><span class="nx">reply_id</span><span class="p">,</span> <span class="nx">message_id</span><span class="p">,</span> <span class="nx">user_id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">destroy</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="o">:</span> <span class="nx">reply_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message_id</span><span class="o">:</span> <span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">user_id</span><span class="o">:</span> <span class="nx">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">async</span> <span class="nx">deleteMessage</span><span class="p">(</span><span class="nx">message_id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kr">await</span> <span class="nx">Reply</span><span class="p">.</span><span class="nx">destroy</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">where</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message_id</span><span class="o">:</span> <span class="nx">message_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">reply</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>reply.js è£¡é¢æœ‰æœƒæ–°å¢å›è¦†ã€ä¿®æ”¹{id}å›è¦†ã€åˆªé™¤{id}å›è¦†ç­‰ï¼Œé™¤æ­¤ä¹‹å¤–é‚„å¤šäº†å…©å€‹ <code>get</code>ã€<code>deleteMessage</code> ç”¨ä¾†å–å¾— version æ¨‚è§€é–ä»¥åŠåŒæ­¥åˆªé™¤å›è¦†åŠŸèƒ½ï¼Œé‚£ä»¥ä¸‹æœƒèªªæ˜å„åˆ¥è² è²¬åŠŸç”¨ï¼š</p>
<ul>
<li>æ–°å¢å›è¦† create()ï¼šå› ç‚ºè¦å…ˆç¢ºèªç•™è¨€æ˜¯å¦è¢«åˆªé™¤ï¼Œæ‰€ä»¥å…ˆä½¿ç”¨ <code>Message.findOne</code> æª¢æŸ¥ç•™è¨€æ˜¯å¦è¢«åˆªé™¤ï¼Œåœ¨ç”¨ <code>Reply.create</code>  æ–°å¢ reply.message_id è·Ÿ reply.user_id ä»¥åŠ reply.contentã€‚</li>
<li>ä¿®æ”¹{id}å›è¦† update()ï¼šä½¿ç”¨ <code>Reply.update</code> æ›´æ–° content ä»¥åŠ versionï¼Œä¸” reply.id è¦ç­‰æ–¼ reply_id åŠ reply.message_id ç­‰æ–¼ message_id åŠ reply.user_id ç­‰æ–¼ user_id åŠ reply.version ç­‰æ–¼ versionã€‚</li>
<li>åˆªé™¤{id}å›è¦† delete()ï¼šä½¿ç”¨ <code>Reply.destroy </code> åˆªé™¤ç¬¦åˆ reply.id ç­‰æ–¼ reply_id è·Ÿ reply.message_id ç­‰æ–¼ message_id åŠ reply.user_id ç­‰æ–¼ user_idã€‚</li>
</ul>
<br>
<h2 id="å¸¸ç”¨æŒ‡ä»¤-sequelize-cli">å¸¸ç”¨æŒ‡ä»¤ (sequelize-cli)</h2>
<ul>
<li>sequelize db:migrateï¼šå°‡è³‡æ–™è¡¨ä¾ç…§ up å…§å®¹åŸ·è¡Œ(<a href="https://pin-yi.me/node-restful-api-repository-messageboard/#migrations" target="_blank" rel="noopener noreffer">migrate æª”æ¡ˆ</a>)ã€‚</li>
<li>sequelize db:migrate:undo:allï¼šå°‡è³‡æ–™è¡¨ä¾ç…§ down å…§å®¹åŸ·è¡Œ(<a href="https://pin-yi.me/node-restful-api-repository-messageboard/#migrations" target="_blank" rel="noopener noreffer">migrate æª”æ¡ˆ</a>)ã€‚</li>
<li>sequelize db:seedï¼šç”¢ç”Ÿå‡è³‡æ–™</li>
</ul>
<br>
<h2 id="postman-æ¸¬è©¦">Postman æ¸¬è©¦</h2>
<h3 id="è¨»å†Š---æˆåŠŸ">è¨»å†Š - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/register-success.png" title="/images/node-restful-api-repository-messageboard/register-success.png" data-thumbnail="/images/node-restful-api-repository-messageboard/register-success.png" data-sub-html="<h2>è¨»å†Š æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/register-success.png"
            data-srcset="/images/node-restful-api-repository-messageboard/register-success.png, /images/node-restful-api-repository-messageboard/register-success.png 1.5x, /images/node-restful-api-repository-messageboard/register-success.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/register-success.png" width="700" />
    </a><figcaption class="image-caption">è¨»å†Š æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="è¨»å†Š---å¤±æ•—ç„¡è¼¸å…¥">è¨»å†Š - å¤±æ•—(ç„¡è¼¸å…¥)</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/register-error-1.png" title="/images/node-restful-api-repository-messageboard/register-error-1.png" data-thumbnail="/images/node-restful-api-repository-messageboard/register-error-1.png" data-sub-html="<h2>è¨»å†Š å¤±æ•—(ç„¡è¼¸å…¥)</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/register-error-1.png"
            data-srcset="/images/node-restful-api-repository-messageboard/register-error-1.png, /images/node-restful-api-repository-messageboard/register-error-1.png 1.5x, /images/node-restful-api-repository-messageboard/register-error-1.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/register-error-1.png" width="700" />
    </a><figcaption class="image-caption">è¨»å†Š å¤±æ•—(ç„¡è¼¸å…¥)</figcaption>
    </figure>
<br>
<h3 id="è¨»å†Š---å¤±æ•—å·²ç¶“è¨»å†Šé">è¨»å†Š - å¤±æ•—(å·²ç¶“è¨»å†Šé)</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/register-error-2.png" title="/images/node-restful-api-repository-messageboard/register-error-2.png" data-thumbnail="/images/node-restful-api-repository-messageboard/register-error-2.png" data-sub-html="<h2>è¨»å†Š å¤±æ•—(å·²ç¶“è¨»å†Šé)</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/register-error-2.png"
            data-srcset="/images/node-restful-api-repository-messageboard/register-error-2.png, /images/node-restful-api-repository-messageboard/register-error-2.png 1.5x, /images/node-restful-api-repository-messageboard/register-error-2.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/register-error-2.png" width="700" />
    </a><figcaption class="image-caption">è¨»å†Š å¤±æ•—(å·²ç¶“è¨»å†Šé)</figcaption>
    </figure>
<br>
<h3 id="ç™»å…¥---æˆåŠŸ">ç™»å…¥ - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/login-success.png" title="/images/node-restful-api-repository-messageboard/login-success.png" data-thumbnail="/images/node-restful-api-repository-messageboard/login-success.png" data-sub-html="<h2>ç™»å…¥ æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/login-success.png"
            data-srcset="/images/node-restful-api-repository-messageboard/login-success.png, /images/node-restful-api-repository-messageboard/login-success.png 1.5x, /images/node-restful-api-repository-messageboard/login-success.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/login-success.png" width="700" />
    </a><figcaption class="image-caption">ç™»å…¥ æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="ç™»å…¥---å¤±æ•—">ç™»å…¥ - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/login-error.png" title="/images/node-restful-api-repository-messageboard/login-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/login-error.png" data-sub-html="<h2>ç™»å…¥ å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/login-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/login-error.png, /images/node-restful-api-repository-messageboard/login-error.png 1.5x, /images/node-restful-api-repository-messageboard/login-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/login-error.png" width="700" />
    </a><figcaption class="image-caption">ç™»å…¥ å¤±æ•—</figcaption>
    </figure>
<br>
<h3 id="æŸ¥è©¢å…¨éƒ¨ç•™è¨€---æˆåŠŸç„¡è³‡æ–™">æŸ¥è©¢å…¨éƒ¨ç•™è¨€ - æˆåŠŸ(ç„¡è³‡æ–™)</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/get-success-1.png" title="/images/node-restful-api-repository-messageboard/get-success-1.png" data-thumbnail="/images/node-restful-api-repository-messageboard/get-success-1.png" data-sub-html="<h2>æŸ¥è©¢ç•™è¨€ æˆåŠŸ(ç„¡è³‡æ–™)</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/get-success-1.png"
            data-srcset="/images/node-restful-api-repository-messageboard/get-success-1.png, /images/node-restful-api-repository-messageboard/get-success-1.png 1.5x, /images/node-restful-api-repository-messageboard/get-success-1.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/get-success-1.png" width="700" />
    </a><figcaption class="image-caption">æŸ¥è©¢ç•™è¨€ æˆåŠŸ(ç„¡è³‡æ–™)</figcaption>
    </figure>
<br>
<h3 id="æŸ¥è©¢å…¨éƒ¨ç•™è¨€---æˆåŠŸæœ‰è³‡æ–™">æŸ¥è©¢å…¨éƒ¨ç•™è¨€ - æˆåŠŸ(æœ‰è³‡æ–™)</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/get-success-2.png" title="/images/node-restful-api-repository-messageboard/get-success-2.png" data-thumbnail="/images/node-restful-api-repository-messageboard/get-success-2.png" data-sub-html="<h2>æŸ¥è©¢ç•™è¨€ æˆåŠŸ(æœ‰è³‡æ–™)</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/get-success-2.png"
            data-srcset="/images/node-restful-api-repository-messageboard/get-success-2.png, /images/node-restful-api-repository-messageboard/get-success-2.png 1.5x, /images/node-restful-api-repository-messageboard/get-success-2.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/get-success-2.png" width="700" />
    </a><figcaption class="image-caption">æŸ¥è©¢ç•™è¨€ æˆåŠŸ(æœ‰è³‡æ–™)</figcaption>
    </figure>
<br>
<h3 id="æŸ¥è©¢idç•™è¨€---æˆåŠŸ">æŸ¥è©¢{id}ç•™è¨€ - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/get-id-succes.png" title="/images/node-restful-api-repository-messageboard/get-id-succes.png" data-thumbnail="/images/node-restful-api-repository-messageboard/get-id-success.png" data-sub-html="<h2>æŸ¥è©¢{id}ç•™è¨€ æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/get-id-succes.png"
            data-srcset="/images/node-restful-api-repository-messageboard/get-id-success.png, /images/node-restful-api-repository-messageboard/get-id-succes.png 1.5x, /images/node-restful-api-repository-messageboard/get-id-succes.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/get-id-succes.png" width="700" />
    </a><figcaption class="image-caption">æŸ¥è©¢{id}ç•™è¨€ æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="æŸ¥è©¢idç•™è¨€---å¤±æ•—">æŸ¥è©¢{id}ç•™è¨€ - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/get-error.png" title="/images/node-restful-api-repository-messageboard/get-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/get-error.png" data-sub-html="<h2>æŸ¥è©¢{id}ç•™è¨€ å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/get-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/get-error.png, /images/node-restful-api-repository-messageboard/get-error.png 1.5x, /images/node-restful-api-repository-messageboard/get-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/get-error.png" width="700" />
    </a><figcaption class="image-caption">æŸ¥è©¢{id}ç•™è¨€ å¤±æ•—</figcaption>
    </figure>
<br>
<h3 id="æ–°å¢ç•™è¨€---æˆåŠŸ">æ–°å¢ç•™è¨€ - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/create.png" title="/images/node-restful-api-repository-messageboard/create.png" data-thumbnail="/images/node-restful-api-repository-messageboard/create.png" data-sub-html="<h2>æ–°å¢ç•™è¨€ æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/create.png"
            data-srcset="/images/node-restful-api-repository-messageboard/create.png, /images/node-restful-api-repository-messageboard/create.png 1.5x, /images/node-restful-api-repository-messageboard/create.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/create.png" width="700" />
    </a><figcaption class="image-caption">æ–°å¢ç•™è¨€ æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="æ–°å¢ç•™è¨€---å¤±æ•—">æ–°å¢ç•™è¨€ - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/create-error.png" title="/images/node-restful-api-repository-messageboard/create-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/create-error.png" data-sub-html="<h2>æ–°å¢ç•™è¨€ å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/create-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/create-error.png, /images/node-restful-api-repository-messageboard/create-error.png 1.5x, /images/node-restful-api-repository-messageboard/create-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/create-error.png" width="700" />
    </a><figcaption class="image-caption">æ–°å¢ç•™è¨€ å¤±æ•—</figcaption>
    </figure>
<br>
<h3 id="ä¿®æ”¹idç•™è¨€---æˆåŠŸ">ä¿®æ”¹{id}ç•™è¨€ - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/patch-success.png" title="/images/node-restful-api-repository-messageboard/patch-success.png" data-thumbnail="/images/node-restful-api-repository-messageboard/patch-success.png" data-sub-html="<h2>ä¿®æ”¹ {id}ç•™è¨€ æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/patch-success.png"
            data-srcset="/images/node-restful-api-repository-messageboard/patch-success.png, /images/node-restful-api-repository-messageboard/patch-success.png 1.5x, /images/node-restful-api-repository-messageboard/patch-success.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/patch-success.png" width="700" />
    </a><figcaption class="image-caption">ä¿®æ”¹ {id}ç•™è¨€ æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="ä¿®æ”¹idç•™è¨€---å¤±æ•—">ä¿®æ”¹{id}ç•™è¨€ - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/patch-error.png" title="/images/node-restful-api-repository-messageboard/patch-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/patch-error.png" data-sub-html="<h2>ä¿®æ”¹ {id}ç•™è¨€ å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/patch-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/patch-error.png, /images/node-restful-api-repository-messageboard/patch-error.png 1.5x, /images/node-restful-api-repository-messageboard/patch-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/patch-error.png" width="700" />
    </a><figcaption class="image-caption">ä¿®æ”¹ {id}ç•™è¨€ å¤±æ•—</figcaption>
    </figure>
<br>
<h3 id="åˆªé™¤idç•™è¨€---æˆåŠŸ">åˆªé™¤{id}ç•™è¨€ - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/delete.png" title="/images/node-restful-api-repository-messageboard/delete.png" data-thumbnail="/images/node-restful-api-repository-messageboard/delete.png" data-sub-html="<h2>åˆªé™¤ {id}ç•™è¨€ æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/delete.png"
            data-srcset="/images/node-restful-api-repository-messageboard/delete.png, /images/node-restful-api-repository-messageboard/delete.png 1.5x, /images/node-restful-api-repository-messageboard/delete.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/delete.png" width="700" />
    </a><figcaption class="image-caption">åˆªé™¤ {id}ç•™è¨€ æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="åˆªé™¤idç•™è¨€---å¤±æ•—">åˆªé™¤{id}ç•™è¨€ - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/delete-error.png" title="/images/node-restful-api-repository-messageboard/delete-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/delete-error.png" data-sub-html="<h2>åˆªé™¤ {id}ç•™è¨€ å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/delete-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/delete-error.png, /images/node-restful-api-repository-messageboard/delete-error.png 1.5x, /images/node-restful-api-repository-messageboard/delete-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/delete-error.png" width="700" />
    </a><figcaption class="image-caption">åˆªé™¤ {id}ç•™è¨€ å¤±æ•—</figcaption>
    </figure>
<br>
<h3 id="æ–°å¢å›è¦†---æˆåŠŸ">æ–°å¢å›è¦† - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/reply-create.png" title="/images/node-restful-api-repository-messageboard/reply-create.png" data-thumbnail="/images/node-restful-api-repository-messageboard/reply-create.png" data-sub-html="<h2>æ–°å¢å›è¦† æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/reply-create.png"
            data-srcset="/images/node-restful-api-repository-messageboard/reply-create.png, /images/node-restful-api-repository-messageboard/reply-create.png 1.5x, /images/node-restful-api-repository-messageboard/reply-create.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/reply-create.png" width="700" />
    </a><figcaption class="image-caption">æ–°å¢å›è¦† æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="æ–°å¢å›è¦†---å¤±æ•—">æ–°å¢å›è¦† - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/reply-create-error.png" title="/images/node-restful-api-repository-messageboard/reply-create-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/reply-create-error.png" data-sub-html="<h2>æ–°å¢å›è¦† å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/reply-create-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/reply-create-error.png, /images/node-restful-api-repository-messageboard/reply-create-error.png 1.5x, /images/node-restful-api-repository-messageboard/reply-create-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/reply-create-error.png" width="700" />
    </a><figcaption class="image-caption">æ–°å¢å›è¦† å¤±æ•—</figcaption>
    </figure>
<br>
<h3 id="ä¿®æ”¹idå›è¦†---æˆåŠŸ">ä¿®æ”¹{id}å›è¦† - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/reply-patch-success.png" title="/images/node-restful-api-repository-messageboard/reply-patch-success.png" data-thumbnail="/images/node-restful-api-repository-messageboard/reply-patch-success.png" data-sub-html="<h2>ä¿®æ”¹ {id}å›è¦† æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/reply-patch-success.png"
            data-srcset="/images/node-restful-api-repository-messageboard/reply-patch-success.png, /images/node-restful-api-repository-messageboard/reply-patch-success.png 1.5x, /images/node-restful-api-repository-messageboard/reply-patch-success.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/reply-patch-success.png" width="700" />
    </a><figcaption class="image-caption">ä¿®æ”¹ {id}å›è¦† æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="ä¿®æ”¹idå›è¦†---å¤±æ•—">ä¿®æ”¹{id}å›è¦† - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/reply-patch-error.png" title="/images/node-restful-api-repository-messageboard/reply-patch-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/reply-patch-error.png" data-sub-html="<h2>ä¿®æ”¹ {id}å›è¦† å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/reply-patch-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/reply-patch-error.png, /images/node-restful-api-repository-messageboard/reply-patch-error.png 1.5x, /images/node-restful-api-repository-messageboard/reply-patch-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/reply-patch-error.png" width="700" />
    </a><figcaption class="image-caption">ä¿®æ”¹ {id}å›è¦† å¤±æ•—</figcaption>
    </figure>
<br>
<h3 id="åˆªé™¤idå›è¦†---æˆåŠŸ">åˆªé™¤{id}å›è¦† - æˆåŠŸ</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/reply-delete.png" title="/images/node-restful-api-repository-messageboard/reply-delete.png" data-thumbnail="/images/node-restful-api-repository-messageboard/reply-delete.png" data-sub-html="<h2>åˆªé™¤ {id}å›è¦† æˆåŠŸ</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/reply-delete.png"
            data-srcset="/images/node-restful-api-repository-messageboard/reply-delete.png, /images/node-restful-api-repository-messageboard/reply-delete.png 1.5x, /images/node-restful-api-repository-messageboard/reply-delete.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/reply-delete.png" width="700" />
    </a><figcaption class="image-caption">åˆªé™¤ {id}å›è¦† æˆåŠŸ</figcaption>
    </figure>
<br>
<h3 id="åˆªé™¤idå›è¦†---å¤±æ•—">åˆªé™¤{id}å›è¦† - å¤±æ•—</h3>
<figure><a class="lightgallery" href="/images/node-restful-api-repository-messageboard/reply-delete-error.png" title="/images/node-restful-api-repository-messageboard/reply-delete-error.png" data-thumbnail="/images/node-restful-api-repository-messageboard/reply-delete-error.png" data-sub-html="<h2>åˆªé™¤ {id}å›è¦† å¤±æ•—</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/node-restful-api-repository-messageboard/reply-delete-error.png"
            data-srcset="/images/node-restful-api-repository-messageboard/reply-delete-error.png, /images/node-restful-api-repository-messageboard/reply-delete-error.png 1.5x, /images/node-restful-api-repository-messageboard/reply-delete-error.png 2x"
            data-sizes="auto"
            alt="/images/node-restful-api-repository-messageboard/reply-delete-error.png" width="700" />
    </a><figcaption class="image-caption">åˆªé™¤ {id}å›è¦† å¤±æ•—</figcaption>
    </figure>
<br>
<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>
<p><a href="https://nodejs.dev/learn/introduction-to-nodejs" target="_blank" rel="noopener noreffer">Node.js å®˜ç¶²</a></p>
<p><a href="https://sequelize.org/v6/index.html" target="_blank" rel="noopener noreffer">Sequelize
</a></p>
<p><a href="https://hackmd.io/@TSMI_E7ORNeP8YBbWm-lFA/ryCtaVW_M?print-pdf#%E4%BD%BF%E7%94%A8sequelize%E5%BB%BA%E7%AB%8B%E4%B8%80%E5%BC%B5user-table" target="_blank" rel="noopener noreffer">é€é sequelize ä¾†é”æˆ DB Schema Migration
</a></p>
<p><a href="https://sebhastian.com/sequelize-join/" target="_blank" rel="noopener noreffer">How to create JOIN queries with Sequelize
</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/node.js/">Node.js</a>
                </span><span><a href="/tags/restful-api/">RESTful API</a>
                </span><span><a href="/tags/mysql/">Mysql</a>
                </span><span><a href="/tags/repository/">Repository</a>
                </span><span><a href="/tags/%E5%AF%A6%E4%BD%9C/">å¯¦ä½œ</a>
                </span><span><a href="/tags/%E4%BB%8B%E7%B4%B9/">ä»‹ç´¹</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°æ–¼ 2022-04-11&nbsp;<a class="git-hash" href="https://github.com/880831ian/blog/commit/66c6f146e0a9f2e36cc652ae425b7037643923c2" target="_blank" title="committed&nbsp;by&nbsp;ian_zhuang(880831ian@gmail.com)&nbsp;66c6f14:&nbsp;# æ–°å¢ Node Repository Restful API çš„ç•™è¨€æ¿">
                            <i class="fas fa-hashtag fa-fw"></i>66c6f14</a></span>
            </div><div class="post-info-mod"><span>
                            <a class="link-to-markdown" href="/node-restful-api-repository-messageboard/index.md" target="_blank">é–±è®€åŸå§‹æ–‡æª”</a>
                        </span><span>
                        &nbsp;|&nbsp;
                        <a class="link-to-markdown" href="https://github.com/880831ian/blog/tree/main/content/posts/node-restful-api-repository-messageboard/index.zh-tw.md" target="_blank">Improve Article</a>
                    </span></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://pin-yi.me/node-restful-api-repository-messageboard/" data-title="ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)" data-hashtags="Node.js,RESTful API,Mysql,Repository,å¯¦ä½œ,ä»‹ç´¹"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://pin-yi.me/node-restful-api-repository-messageboard/" data-hashtag="Node.js"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://pin-yi.me/node-restful-api-repository-messageboard/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Reddit" data-sharer="reddit" data-url="https://pin-yi.me/node-restful-api-repository-messageboard/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://pin-yi.me/node-restful-api-repository-messageboard/" data-title="ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://pin-yi.me/node-restful-api-repository-messageboard/" data-title="ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Skype" data-sharer="skype" data-url="https://pin-yi.me/node-restful-api-repository-messageboard/" data-title="ç”¨ Node.jså¯«ä¸€å€‹ Repository Restful API çš„ç•™è¨€æ¿ (expressã€sequelize å¥—ä»¶)"><i class="fab fa-skype fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/node/" class="prev" rel="prev" title="Node.js ä»‹ç´¹"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/git/" class="next" rel="next" title="Git ä»‹ç´¹">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div><div id="comments" class="single-card"><div id="disqus_thread"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://pin-yi.me">PinYi</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=1.0.1', { scope: '/' })
        .then(() => {
            console.info('PinYi\u00A0Service Worker Registered');
        }, err => console.error('PinYi\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('PinYi\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é ‚éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è©•è«–">
                <i class="fas fa-comment-alt fa-fw"></i>
            </a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.1-beta.0/dist/css/lightgallery.min.css"><script src="https://pin-yi.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.0/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.zh.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.1-beta.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.1/sharer.min.js"></script><script>window.config={"code":{"copyTitle":"è¤‡è£½åˆ°å‰ªè²¼æ¿","maxShownLines":120},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ‰¾ä¸åˆ°ä½ è¼¸å…¥çš„è³‡æ–™ğŸ¥²","snippetLength":50,"type":"lunr"}};</script><script src="/js/theme.min.js"></script></body></html>
