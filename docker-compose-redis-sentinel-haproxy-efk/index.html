<!DOCTYPE html>
<html lang="zh-tw">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose) - PinYi</title><meta name="description" content="é€™è£¡æ˜¯é—œæ–¼ä¸€å€‹èœé³¥å·¥ç¨‹å¸«æ–œæ§“Youtuberçš„éƒ¨è½æ ¼"><meta property="og:title" content="ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)" />
<meta property="og:description" content="å‰æƒ…æè¦ï¼šæœ¬ç¯‡æ˜¯ ç”¨ HAProxy å° Redis åšè² è¼‰å¹³è¡¡ (Redis Sentinelã€Docker-compose) ä»¥åŠ Redis å“¨å…µæ¨¡å¼ (Sentinel) æ­é… Docker-compose å¯¦ä½œ çš„å¾ŒçºŒæ–‡ç« ï¼Œä¸»è¦æœƒå„ªåŒ–åŸæœ¬çš„ç¨‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/" /><meta property="og:image" content="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/featured-image.webp"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-28T09:06:00+08:00" />
<meta property="article:modified_time" content="2022-04-28T11:30:07+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/featured-image.webp"/>
<meta name="twitter:title" content="ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)"/>
<meta name="twitter:description" content="å‰æƒ…æè¦ï¼šæœ¬ç¯‡æ˜¯ ç”¨ HAProxy å° Redis åšè² è¼‰å¹³è¡¡ (Redis Sentinelã€Docker-compose) ä»¥åŠ Redis å“¨å…µæ¨¡å¼ (Sentinel) æ­é… Docker-compose å¯¦ä½œ çš„å¾ŒçºŒæ–‡ç« ï¼Œä¸»è¦æœƒå„ªåŒ–åŸæœ¬çš„ç¨‹"/>
<meta name="application-name" content="PinYi éƒ¨è½æ ¼">
<meta name="apple-mobile-web-app-title" content="PinYi éƒ¨è½æ ¼"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/avatar.webp"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/" /><link rel="prev" href="https://blog.pin-yi.me/glamping/" /><link rel="next" href="https://blog.pin-yi.me/k8s/" /><link rel="stylesheet" href="/css/page.min.css"><link rel="stylesheet" href="/css/home.min.css">
        <link href="https://www.googletagmanager.com" rel="preconnect" crossorigin>
        <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)",
        "inLanguage": "zh-tw",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.pin-yi.me\/docker-compose-redis-sentinel-haproxy-efk\/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https:\/\/blog.pin-yi.me\/docker-compose-redis-sentinel-haproxy-efk\/featured-image.webp",
                            "width":  1280 ,
                            "height":  300 
                        }],"genre": "posts","keywords": "EFK, HAProxy, Redis, Docker, Sentinel, è² è¼‰å¹³è¡¡, å“¨å…µæ¨¡å¼, å¯¦ä½œ","wordcount":  3777 ,
        "url": "https:\/\/blog.pin-yi.me\/docker-compose-redis-sentinel-haproxy-efk\/","datePublished": "2022-04-28T09:06:00+08:00","dateModified": "2022-04-28T11:30:07+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Zhuang,Pin-Yi","logo": "https:\/\/blog.pin-yi.me\/images\/avatar.webp"},"author": {
                "@type": "Person",
                "name": "PinYi"
            },"description": ""
    }
    </script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EK8X0P9SDS"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-EK8X0P9SDS', { 'anonymize_ip': false });
}
</script>
</head><body data-header-desktop="fixed" data-header-mobile="fixed"><script>(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="PinYi">PinYi éƒ¨è½æ ¼</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> æ‰€æœ‰æ–‡ç«  </a><a class="menu-item" href="/categories/"> æ–‡ç« åˆ†é¡ </a><a class="menu-item" href="/tags/"> æ–‡ç« æ¨™ç±¤ </a><a class="menu-item" href="/categories/youtube/"> YouTube å½±ç‰‡ </a><a class="menu-item" href="https://pin-yi.me" rel="noopener noreffer" target="_blank"> é—œæ–¼æˆ‘ </a><span class="menu-item delimiter"></span><span class="menu-item language" title="é¸æ“‡èªè¨€">ç¹é«”ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
                        <select class="language-select" id="language-select-desktop" onchange="location = this.value;"><option value="/docker-compose-redis-sentinel-haproxy-efk/" selected>ç¹é«”ä¸­æ–‡</option></select>
                    </span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="è«‹è¼¸å…¥è¦æœå°‹çš„æ¨™é¡Œæˆ–æ˜¯å…§å®¹" id="search-input-desktop">
                        <a href="#" class="search-button search-toggle" id="search-toggle-desktop" title="æœå°‹">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a class="menu-item" href="/index.xml" title="RSS"><i class="fas fa-rss fa-fw" title="RSS"></i> </a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ›ä¸»é¡Œ">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="PinYi">PinYi éƒ¨è½æ ¼</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="è«‹è¼¸å…¥è¦æœå°‹çš„æ¨™é¡Œæˆ–æ˜¯å…§å®¹" id="search-input-mobile">
                        <a href="#" class="search-button search-toggle" id="search-toggle-mobile" title="æœå°‹">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/posts/" title="">æ‰€æœ‰æ–‡ç« </a><a class="menu-item" href="/categories/" title="">æ–‡ç« åˆ†é¡</a><a class="menu-item" href="/tags/" title="">æ–‡ç« æ¨™ç±¤</a><a class="menu-item" href="/categories/youtube/" title="">YouTube å½±ç‰‡</a><a class="menu-item" href="https://pin-yi.me" title="" rel="noopener noreffer" target="_blank">é—œæ–¼æˆ‘</a><div class="menu-item"><a href="/index.xml" title="RSS"><i class="fas fa-rss fa-fw" title="RSS"></i> </a>
                <span>&nbsp;|&nbsp;</span><a href="javascript:void(0);" class="theme-switch" title="åˆ‡æ›ä¸»é¡Œ">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div><span class="menu-item language" title="é¸æ“‡èªè¨€">ç¹é«”ä¸­æ–‡<i class="fas fa-chevron-right fa-fw"></i>
                    <select class="language-select" onchange="location = this.value;"><option value="/docker-compose-redis-sentinel-haproxy-efk/" selected>ç¹é«”ä¸­æ–‡</option></select>
                </span></div>
    </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®éŒ„</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single" data-toc="enable"><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/docker-compose-redis-sentinel-haproxy-efk/featured-image.webp"
        data-srcset="/docker-compose-redis-sentinel-haproxy-efk/featured-image.webp, /docker-compose-redis-sentinel-haproxy-efk/featured-image.webp 1.5x, /docker-compose-redis-sentinel-haproxy-efk/featured-image.webp 2x"
        data-sizes="auto"
        alt="/docker-compose-redis-sentinel-haproxy-efk/featured-image.webp"
        title="/docker-compose-redis-sentinel-haproxy-efk/featured-image.webp" /></div><div class="single-card" data-image="true"><h2 class="single-title animated flipInX">ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)</h2><div class="post-meta">
                <div class="post-meta-line"><span class="post-author"><a href="https://pin-yi.me" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>PinYi</a></span>&nbsp;<span class="post-category">å‡ºç‰ˆæ–¼  <a href="/categories/codenotes/"><i class="far fa-folder fa-fw"></i>ç¨‹å¼ç­†è¨˜</a></span></div>
                <div class="post-meta-line"><span><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-04-28">2022-04-28</time></span>&nbsp;<span><i class="fas fa-pencil-alt fa-fw"></i>&nbsp;ç´„ 3777 å­—</span>&nbsp;
                    <span><i class="far fa-clock fa-fw"></i>&nbsp;é è¨ˆé–±è®€ 8 åˆ†é˜</span>&nbsp;</div>
            </div>
            
            <hr><div class="details toc" id="toc-static"  data-kept="">
                    <div class="details-summary toc-title">
                        <span>ç›®éŒ„</span>
                        <span><i class="details-icon fas fa-angle-right"></i></span>
                    </div>
                    <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#ä»€éº¼æ˜¯-efk-">ä»€éº¼æ˜¯ EFK ?</a></li>
    <li><a href="#å¯¦ä½œ">å¯¦ä½œ</a>
      <ul>
        <li><a href="#æª”æ¡ˆçµæ§‹">æª”æ¡ˆçµæ§‹</a></li>
        <li><a href="#docker-volumefluentdfluentconf">docker-volume/fluentd/fluent.conf</a></li>
        <li><a href="#fluentddockerfile">fluentd/Dockerfile</a></li>
        <li><a href="#efkdocker-composeyaml">efk/Docker-compose.yaml</a></li>
        <li><a href="#nginx_php_redisdocker-composeyaml">nginx_php_redis/Docker-compose.yaml</a></li>
        <li><a href="#haproxy_sentineldocker-composeyaml">haproxy_sentinel/Docker-compose.yaml</a></li>
      </ul>
    </li>
    <li><a href="#æ¸¬è©¦">æ¸¬è©¦</a></li>
    <li><a href="#åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</a></li>
  </ul>
</nav></div>
                </div><div class="content" id="content"><p>å‰æƒ…æè¦ï¼šæœ¬ç¯‡æ˜¯ <a href="https://pin-yi.me/docker-compose-redis-sentinel-haproxy/" target="_blank" rel="noopener noreffer">ç”¨ HAProxy å° Redis åšè² è¼‰å¹³è¡¡ (Redis Sentinelã€Docker-compose)</a>
ä»¥åŠ <a href="https://pin-yi.me/docker-compose-redis-sentinel/" target="_blank" rel="noopener noreffer">Redis å“¨å…µæ¨¡å¼ (Sentinel) æ­é… Docker-compose å¯¦ä½œ</a> çš„å¾ŒçºŒæ–‡ç« ï¼Œä¸»è¦æœƒå„ªåŒ–åŸæœ¬çš„ç¨‹å¼ç¢¼ï¼Œä¸¦ä½¿ç”¨ EFK ä¾†æ”¶é›†LOGï¼</p>
<h2 id="ä»€éº¼æ˜¯-efk-">ä»€éº¼æ˜¯ EFK ?</h2>
<p>éš¨è‘—ç¾åœ¨å„ç¨®ç¨‹å¼ç³»çµ±è¤‡é›œåº¦è¶Šä¾†è¶Šé«˜ï¼Œç‰¹åˆ¥æ˜¯ç¾åœ¨éƒ½å¾€é›²ä¸Šé–‹å§‹ä½œéƒ¨ç½²ï¼Œç•¶æˆ‘å€‘æƒ³è¦æŸ¥çœ‹ log çš„æ™‚å€™ï¼Œä¸å¯èƒ½ä¸€å€‹ä¸€å€‹å»ç™»å…¥å„ç¯€é»å»æŸ¥çœ‹ logï¼Œä¸åƒ…æ•ˆç‡ä½ï¼Œä¹Ÿæœƒæœ‰å®‰å…¨æ€§çš„å•é¡Œï¼Œæ‰€ä»¥ä¸å¯èƒ½è®“å·¥ç¨‹å¸«ç›´æ¥å»è¨ªå•æ¯ä¸€å€‹ç¯€é»ã€‚</p>
<p>è€Œä¸”ç¾åœ¨å¤§è¦æ¨¡çš„ç³»çµ±åŸºæœ¬ä¸Šéƒ½æ¡ç”¨å¢é›†çš„éƒ¨ç½²æ–¹å¼ï¼Œæ„å‘³è‘—å°æ¯å€‹ serviceï¼Œæœƒå•Ÿå‹•å¤šå€‹å®Œå…¨ä¸€æ¨£çš„ POD å°å¤–æä¾›æœå‹™ï¼Œæ¯å€‹ container éƒ½æœƒç”¢ç”Ÿè‡ªå·±çš„ logï¼Œå¾ç”¢ç”Ÿ log ä¾†çœ‹ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“æ˜¯ç”±å“ªå€‹ POD ç”¢ç”Ÿçš„ï¼Œé€™æ¨£å°æŸ¥çœ‹åˆ†ä½ˆå¼çš„æ—¥èªŒæ›´åŠ å›°é›£ã€‚</p>
<p>æ‰€ä»¥åœ¨é›²æ™‚ä»£ï¼Œéœ€è¦ä¸€å€‹æ”¶é›†ä¸¦åˆ†æ log çš„è§£æ±ºæ–¹æ¡ˆã€‚é¦–å…ˆéœ€è¦å°‡åˆ†ä½ˆåœ¨å„å€‹è§’è½çš„ log çµ±ä¸€æ”¶é›†åˆ°ä¸€å€‹é›†ä¸­çš„åœ°æ–¹ï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚æ”¶é›†ä¹‹å¾Œï¼Œé‚„å¯ä»¥é€²è¡Œå„ç¨®çµ±è¨ˆä»¥åŠåˆ†æï¼Œç”šè‡³ç”¨æµè¡Œçš„å¤§æ•¸æ“šæˆ–æ©Ÿå™¨å­¸ç¿’çš„æ–¹æ³•ä¾†é€²è¡Œåˆ†æã€‚</p>
<br>
<p>æ‰€ä»¥èª•ç”Ÿäº† ELK æˆ–æ˜¯ EFK çš„è§£æ±ºæ–¹å¼ï¼š</p>
<p>ELK æ˜¯ç”± Elasticsearchã€Logstashã€Kibana æ‰€çµ„æˆï¼Œ EFK æ˜¯ç”± Elasticsearchã€(Filebeats or Fluentd)ã€Kibana æ‰€çµ„æˆï¼Œå…©è€…çš„å·®ç•°åœ¨ä¸­é–“ä½¿ç”¨çš„é–‹æºç¨‹å¼ï¼Œæˆ‘æœƒåˆ†åˆ¥ä»‹ç´¹ä¸€ä¸‹æ¯ä¸€å€‹ç¨‹å¼ä¸»è¦çš„ç”¨é€”ï¼š</p>
<ul>
<li>Elasticsearchï¼šå®ƒæ˜¯ä¸€å€‹é›†ä¸­å„²å­˜ log çš„åœ°æ–¹ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒæ˜¯ä¸€å€‹å…¨æ–‡æª¢ç´¢ä»¥åŠåˆ†æçš„å¼•æ“ï¼Œå®ƒèƒ½è®“ç”¨æˆ¶ä»¥è¿‘ä¹å¯¦æ™‚çš„æ–¹å¼ä¾†æŸ¥çœ‹ã€åˆ†ææµ·é‡çš„æ•¸æ“šã€‚</li>
<li>Logstashã€Filebeatsã€Fluentdï¼šå®ƒå€‘ä¸»è¦æ˜¯æ”¶é›†åˆ†ä½ˆåœ¨å„è™•çš„ log ä¸¦é€²è¡Œè™•ç†(Filebeats åƒ…æ”¶é›†)ã€‚</li>
<li>Kibanaï¼šå®ƒæ˜¯ç‚º Elasticsearch é–‹ç™¼çš„å‰ç«¯ GUIï¼Œå¯ä»¥è®“ç”¨æˆ¶å¾ˆæ–¹ä¾¿çš„ä»¥åœ–å½¢åŒ–é€²è¡ŒæŸ¥è©¢ Elasticsearch ä¸­å„²å­˜çš„æ•¸æ“šï¼ŒåŒæ™‚ä¹Ÿæä¾›å„å¼å„æ¨£çš„æ¨¡çµ„å¯ä»¥ä½¿ç”¨ã€‚</li>
</ul>
<br>
<p>Logstashã€Filebeatsã€Fluentd é—œä¿‚ï¼š</p>
<p>Filebeats æ˜¯ä¸€å€‹è¼•é‡ç´šæ”¶é›†æœ¬åœ° log æ•¸æ“šçš„æ–¹æ¡ˆï¼Œå®ƒåƒ…èƒ½æ”¶é›†æœ¬åœ°çš„ logï¼Œä¸èƒ½å° log åšè™•ç†ï¼Œæ‰€ä»¥ Filebeats é€šå¸¸æœƒå°‡ log é€åˆ° Logstash åšé€²ä¸€æ­¥çš„è™•ç†ã€‚</p>
<p>é‚£ç‚ºä»€éº¼ä¸ç›´æ¥ä½¿ç”¨ Logstash ä¾†æ”¶é›†æ”¶é›†ä¸¦è™•ç† log å‘¢ï¼Ÿ</p>
<p>å› ç‚º Logstash æœƒæ¶ˆè€—è¨±å¤šçš„è¨˜æ†¶é«”ï¼Œæ‰€ä»¥æ‰æœƒå…ˆé€é Filebeats æ”¶é›†è³‡æ–™å†å‚³çµ¦ Logstash åšè™•ç†ã€‚</p>
<p>å¦å¤– Filebeatsã€Logstashã€Elasticsearch å’Œ Kibana éƒ½æ˜¯å±¬æ–¼åŒä¸€å®¶å…¬å¸çš„é–‹æºé …ç›®ï¼š<a href="https://www.elastic.co/guide/index.html" target="_blank" rel="noopener noreffer">https://www.elastic.co/guide/</a></p>
<p>è€Œ Fluentd å‰‡æ˜¯å¦ä¸€å®¶å…¬å¸çš„é–‹æºé …ç›®ï¼š<a href="https://docs.fluentd.org/" target="_blank" rel="noopener noreffer">https://docs.fluentd.org/</a></p>
<p>é‚£æˆ‘å€‘åœ¨é€™é‚Šå°±ä½¿ç”¨ Fluentd ä¾†åšæˆ‘å€‘çš„ EFK ç¤ºç¯„ï¼š</p>
<br>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg" title="/images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg" data-sub-html="<h2>EFK ç¤ºæ„åœ– EFK Stack: Elasticsearch, Fluentd and Kibana on Docker</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg, /images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/efk.jpeg" width="700" />
    </a><figcaption class="image-caption">EFK ç¤ºæ„åœ– <a href="https://aesher9o1.medium.com/efk-stack-elasticsearch-fluentd-and-kibana-on-docker-be60597fa99" target="_blank" rel="noopener noreffer">EFK Stack: Elasticsearch, Fluentd and Kibana on Docker</a></figcaption>
    </figure>
<br>
<p>ä¸Šé¢é€™å¼µåœ–ä»£è¡¨æˆ‘å€‘æœƒæœ‰å¾ˆå¤š Docker å®¹å™¨çš„ log (ä¹Ÿå°±æ˜¯ä¹‹å‰çš„ redis ä»¥åŠå…¶ä»– nginx ç­‰çš„å®¹å™¨)ï¼Œæœƒå…ˆé€é Fluentd æ”¶é›†ä¸¦è™•ç†å„å®¹å™¨çš„ log åœ¨å‚³é€åˆ° Elasticsearch é›†ä¸­å„²å­˜ï¼Œå†ä½¿ç”¨ Kibana åœ–å½¢åŒ–ä»‹é¢ä¾†æŸ¥è©¢æˆ–æª¢ç´¢å„²åœ¨ Elasticsearch çš„ logã€‚</p>
<br>
<h2 id="å¯¦ä½œ">å¯¦ä½œ</h2>
<p>é‚£æ¥ä¸‹ä¾†æœƒä½¿ç”¨ Docker-compose å¯¦ä½œ EFK çš„ LOG åˆ†æï¼Œ<a href="https://github.com/880831ian/docker-compose-redis-sentinel-haproxy-efk" target="_blank" rel="noopener noreffer">ç¯„ä¾‹ç¨‹å¼é€£çµ é»æˆ‘</a> ğŸ˜˜</p>
<p>ç‰ˆæœ¬è³‡è¨Š</p>
<ul>
<li>macOSï¼š11.6</li>
<li>Dockerï¼šDocker version 20.10.12, build e91ed57</li>
<li>Nginxï¼š1.20</li>
<li>PHPï¼š7.4-fpm</li>
<li>Redisï¼š6.2.6</li>
<li>HAProxyï¼šHAProxy version 2.5.5-384c5c5 2022/03/14 - <a href="https://haproxy.org/" target="_blank" rel="noopener noreffer">https://haproxy.org/</a></li>
<li>Elasticsearchï¼š8.1.3</li>
<li>Fluentdï¼šv1.14</li>
<li>Kibanaï¼š8.1.3</li>
</ul>
<br>
<h3 id="æª”æ¡ˆçµæ§‹">æª”æ¡ˆçµæ§‹</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">â”œâ”€â”€ docker-volume
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ fluentd
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â””â”€â”€ fluent.conf
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ haproxy
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â””â”€â”€ haproxy.cfg
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ nginx
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â””â”€â”€ nginx.conf
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ php
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ info.php
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â”œâ”€â”€ r.php
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â””â”€â”€ rw.php
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ redis
</span></span><span class="line"><span class="cl">â”‚Â Â      â”œâ”€â”€ redis.conf
</span></span><span class="line"><span class="cl">â”‚Â Â      â”œâ”€â”€ redis1
</span></span><span class="line"><span class="cl">â”‚Â Â      â”œâ”€â”€ redis2
</span></span><span class="line"><span class="cl">â”‚Â Â      â””â”€â”€ redis3
</span></span><span class="line"><span class="cl">â”œâ”€â”€ docker.sh
</span></span><span class="line"><span class="cl">â”œâ”€â”€ efk
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ Docker-compose.yaml
</span></span><span class="line"><span class="cl">â”œâ”€â”€ fluentd
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ Dockerfile
</span></span><span class="line"><span class="cl">â”œâ”€â”€ haproxy_sentinel
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ Docker-compose.yaml
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ sentinel1
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â””â”€â”€ sentinel.conf
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ sentinel2
</span></span><span class="line"><span class="cl">â”‚Â Â  â”‚Â Â  â””â”€â”€ sentinel.conf
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ sentinel3
</span></span><span class="line"><span class="cl">â”‚Â Â      â””â”€â”€ sentinel.conf
</span></span><span class="line"><span class="cl">â”œâ”€â”€ nginx_php_redis
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ Docker-compose.yaml
</span></span><span class="line"><span class="cl">â””â”€â”€ php
</span></span><span class="line"><span class="cl">    â””â”€â”€ Dockerfile
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<p>é€™æ˜¯ä¸»è¦çš„çµæ§‹ï¼Œç°¡å–®èªªæ˜ä¸€ä¸‹ï¼š(æª”æ¡ˆè¶Šä¾†è¶Šå¤šäº†XDï¼Œé€™æ¬¡æŠŠæ¯ä¸€å€‹éƒ½æœ‰åˆ†é¡ï¼Œæ‰€ä»¥çµæ§‹æœƒèˆ‡ä¹‹å‰ä¸å¤ªç›¸åŒ)</p>
<ul>
<li>docker-volume/fluentd/fluent.confï¼šfluentd çš„è¨­å®šæª”ã€‚</li>
<li>docker-volume/haproxy/haproxy.cfgï¼šhaproxy çš„è¨­å®šæª”ã€‚</li>
<li>docker-volume/nginx/nginx.confï¼šnginx çš„è¨­å®šæª”ã€‚</li>
<li>docker-volume/php/(r.phpã€rw.php)ï¼šæ¸¬è©¦ç”¨æª”æ¡ˆã€‚</li>
<li>docker-volume/redis/redis.confï¼šredis çš„è¨­å®šæª”ã€‚</li>
<li>docker-volume/redis/(redis1ã€redis2ã€redis3)ï¼šæ”¾ redis çš„è³‡æ–™ã€‚</li>
<li>docker.shï¼šæ˜¯æˆ‘å¦å¤–å¤šå¯«çš„è…³æœ¬ï¼Œå¯ä»¥æŸ¥çœ‹ç›¸å°æ‡‰çš„è§’è‰²ã€‚</li>
<li>efk/Docker-compose.yamlï¼šæœƒæ”¾ç½®è¦ç”¢ç”Ÿçš„ elasticsearchã€kibanaã€fluentd çš„å®¹å™¨è¨­å®šæª”ã€‚</li>
<li>fluentd/Dockerfileï¼šå› ç‚º fluentd éœ€è¦å¦å¤–å®‰è£ fluent-plugin-elasticsearch æ‰èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥ç”¨ Dockerfile å¦å¤–å¯« fluent çš„æ˜ åƒæª”ã€‚</li>
<li>haproxy_sentinel/Docker-compose.yamlï¼šæœƒæ”¾ç½®è¦ç”¢ç”Ÿçš„ haproxyã€sentinel1ã€sentinel2ã€sentinel3 çš„å®¹å™¨è¨­å®šæª”ã€‚</li>
<li>haproxy_sentinel/(sentinel1ã€sentinel2ã€sentinel3)/.confï¼šå“¨å…µçš„è¨­å®šæª”ã€‚</li>
<li>nginx_php_redis/Docker-compose.yamlï¼šæœƒæ”¾ç½®è¦ç”¢ç”Ÿçš„ nginxã€phpã€redis1ã€redis2ã€redis3 çš„å®¹å™¨è¨­å®šæª”ã€‚</li>
<li>php/Dokcerfileï¼šå› ç‚ºåœ¨ php è¦ä½¿ç”¨ redis éœ€è¦å¤šå®‰è£ä¸€äº›è¨­å®šï¼Œæ‰€ä»¥ç”¨ Dockerfile å¦å¤–å¯« PHP çš„æ˜ åƒæª”ã€‚</li>
</ul>
<br>
<p>é‚£æˆ‘å€‘å°±ä¾ç…§å®‰è£çš„è¨­å®šé–‹å§‹èªªæ˜ï¼š(é€™é‚Šåªèªªæ˜èˆ‡ä¸Šä¸€ç¯‡ä¸åŒåœ°æ–¹ï¼Œé‡è¤‡çš„å°±è«‹å¤§å®¶å›å»çœ‹ä¹‹å‰çš„æ–‡ç« )</p>
<h3 id="docker-volumefluentdfluentconf">docker-volume/fluentd/fluent.conf</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;source&gt;
</span></span><span class="line"><span class="cl">  @type forward
</span></span><span class="line"><span class="cl">  bind 0.0.0.0
</span></span><span class="line"><span class="cl">  port 24224
</span></span><span class="line"><span class="cl">&lt;/source&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;match *.**&gt;
</span></span><span class="line"><span class="cl">  @type copy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  &lt;store&gt;
</span></span><span class="line"><span class="cl">    @type elasticsearch
</span></span><span class="line"><span class="cl">    host elasticsearch
</span></span><span class="line"><span class="cl">    port 9200
</span></span><span class="line"><span class="cl">    logstash_format true
</span></span><span class="line"><span class="cl">    logstash_prefix fluentd
</span></span><span class="line"><span class="cl">    logstash_dateformat %Y%m%d
</span></span><span class="line"><span class="cl">    include_tag_key true
</span></span><span class="line"><span class="cl">    type_name access_log
</span></span><span class="line"><span class="cl">    tag_key @log_name
</span></span><span class="line"><span class="cl">    flush_interval 1s
</span></span><span class="line"><span class="cl">  &lt;/store&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  &lt;store&gt;
</span></span><span class="line"><span class="cl">    @type stdout
</span></span><span class="line"><span class="cl">  &lt;/store&gt;
</span></span><span class="line"><span class="cl">&lt;/match&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€™æ˜¯ fluent çš„è¨­å®šæª”ï¼Œå¯ä»¥åœ¨é€™é‚Šåšè‡ªè¨‚çš„è¨­å®šï¼Œä¾‹å¦‚ hostã€portã€é è¨­æ—¥æœŸã€tag_key ç­‰ç­‰ã€‚</p>
<br>
<h3 id="fluentddockerfile">fluentd/Dockerfile</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> fluent/fluentd:v1.14</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> root</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="o">[</span><span class="s2">&#34;gem&#34;</span>, <span class="s2">&#34;install&#34;</span>, <span class="s2">&#34;fluent-plugin-elasticsearch&#34;</span><span class="o">]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› ç‚ºæˆ‘å€‘éœ€è¦å…ˆå®‰è£ fluent-plugin-elasticsearch æ‰å¯ä»¥è®“ fluentd ä¾†ä½¿ç”¨ elasticsearchï¼Œæ‰€ä»¥å¤šå¯«ä¸€å€‹ Dockerfile ä¾†è¨­å®šã€‚</p>
<br>
<h3 id="efkdocker-composeyaml">efk/Docker-compose.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">elasticsearch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">elasticsearch:8.1.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">elasticsearch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">discovery.type=single-node</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">xpack.security.enabled=false</span><span class="w"> </span><span class="c"># elasticsearch 8.xç‰ˆæœ¬å¾Œæœƒè‡ªå‹•é–‹å•ŸSSL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">9200</span><span class="p">:</span><span class="m">9200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">kibana</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">kibana:8.1.3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">kibana</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># - I18N_LOCALE=zh-CN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">5601</span><span class="p">:</span><span class="m">5601</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">elasticsearch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">fluentd</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l">../fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/fluentd:/fluentd/etc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">elasticsearch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;24224:24224&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;24224:24224/udp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l">bridge</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">efk_network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ipam</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.0</span><span class="l">/16</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é€™é‚Šæ˜¯è¨­å®š EFK ä¸‰å€‹å®¹å™¨çš„æª”æ¡ˆï¼Œæ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ elasticsearch åœ¨ 8.x ç‰ˆæœ¬å¾Œæœƒè‡ªå‹•é–‹å•Ÿ SSL é€£ç·šï¼Œæ‰€ä»¥æ²’æœ‰ä½¿ç”¨çš„æˆ–æ˜¯åœ¨æ¸¬è©¦ä¸­çš„è¦å…ˆæŠŠå®ƒé—œæ‰ï¼Œä¸ç„¶æœƒé€£ä¸ä¸Šï¼ï¼Œkibana å®ƒæ”¯æ´ I18N å¤šèªç³»ï¼Œä½†ç›®å‰æ²’æœ‰ç¹é«”ä¸­æ–‡ï¼Œæ‰€ä»¥æƒ³è¦çœ‹ä¸­æ–‡çš„å¯ä»¥åˆ‡æˆ zh-CH çš„ç°¡é«”ä¸­æ–‡ä¾†ä½¿ç”¨ï¼Œå…¶ä»–å°±æ˜¯åŸºæœ¬çš„è¨­å®š Posts ä»¥åŠæˆ‘å€‘å…¨éƒ¨è¨­å®šå¥½ IPï¼Œåœ¨å¾ŒçºŒæ¸¬è©¦æœƒæ¯”è¼ƒæ–¹ä¾¿ï½</p>
<br>
<h3 id="nginx_php_redisdocker-composeyaml">nginx_php_redis/Docker-compose.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3.8&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">nginx</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8080</span><span class="p">:</span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/nginx/:/etc/nginx/conf.d/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">php</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l">../php</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">php</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">expose</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">9000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/php/:/var/www/html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">php</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis1</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">redis1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">redis-server /usr/local/etc/redis/redis.conf --appendonly yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/redis/redis1/:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/redis/:/usr/local/etc/redis/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.11</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">6379</span><span class="p">:</span><span class="m">6379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">redis1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">redis2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">redis-server /usr/local/etc/redis/redis.conf --slaveof redis1 6379 --appendonly yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/redis/redis2/:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/redis/:/usr/local/etc/redis/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">6380</span><span class="p">:</span><span class="m">6379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">redis2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis3</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">redis3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">redis-server /usr/local/etc/redis/redis.conf --slaveof redis1 6379 --appendonly yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/redis/redis3/:/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/redis/:/usr/local/etc/redis/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.13</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">6381</span><span class="p">:</span><span class="m">6379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">redis3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">efk_network</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£é€™é‚ŠåŸºæœ¬ä¸Šéƒ½èˆ‡ä¸Šä¸€ç¯‡ä¸€æ¨£ï¼Œæ²’æœ‰ä¿®æ”¹ç‰¹åˆ¥çš„åœ°æ–¹ï¼Œåªæœ‰ä¿®æ”¹ç¶²è·¯åç¨±ä»¥åŠï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘å€‘è¦æŠŠæ¯ä¸€å€‹å®¹å™¨çš„ log é€²è¡Œæ”¶é›†èˆ‡è™•ç†ï¼Œæ‰€ä»¥æˆ‘å€‘ä½¿ç”¨ logging ç„¶å¾Œ driver é¸æ“‡ fluentdï¼Œä¸¦ä¸”è¦è¨­å®š fluentd çš„ IP ä½ç½®ä»¥åŠæ¯ä¸€å€‹å®¹å™¨å¯è¨­å®šä¸åŒçš„ tag æ–¹ä¾¿æˆ‘å€‘æŸ¥è©¢ã€‚</p>
<br>
<h3 id="haproxy_sentineldocker-composeyaml">haproxy_sentinel/Docker-compose.yaml</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">haproxy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">haproxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">haproxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">../docker-volume/haproxy/:/usr/local/etc/haproxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">16379</span><span class="p">:</span><span class="m">6379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8404</span><span class="p">:</span><span class="m">8404</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">haproxy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">sentinel1</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">redis-sentinel-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">26379</span><span class="p">:</span><span class="m">26379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">redis-server /usr/local/etc/redis/sentinel.conf --sentinel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./sentinel1:/usr/local/etc/redis/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">sentinel1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">sentinel2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">redis-sentinel-2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">26380</span><span class="p">:</span><span class="m">26379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">redis-server /usr/local/etc/redis/sentinel.conf --sentinel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./sentinel2:/usr/local/etc/redis/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">sentinel2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">sentinel3</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">redis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">redis-sentinel-3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">26381</span><span class="p">:</span><span class="m">26379</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">redis-server /usr/local/etc/redis/sentinel.conf --sentinel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">./sentinel3:/usr/local/etc/redis/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Taipei</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fluentd&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">fluentd-address</span><span class="p">:</span><span class="w"> </span><span class="m">172.20.0.5</span><span class="p">:</span><span class="m">24224</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="l">sentinel3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">efk_network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">efk_network</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>èˆ‡å‰é¢ä¸€æ¨£ï¼Œå¤šäº†ä¸€å€‹ logging ä¾†è¨­å®š fluentd ä½ç½®ä»¥åŠ tagã€‚</p>
<br>
<h2 id="æ¸¬è©¦">æ¸¬è©¦</h2>
<p>æˆ‘å€‘å…ˆç”¨ docker-compose up ä¾†å•Ÿå‹• efk/Docker-compose.yamlï¼Œæ¥è‘—å†å•Ÿå‹• nginx_php_redis/Docker-compose.yamlï¼Œæœ€å¾Œå•Ÿå‹• haproxy_sentinel/Docker-compose.yamlï¼š</p>
<br>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png" data-sub-html="<h2>å•Ÿå‹• efk/Docker-compose.yaml</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png, /images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/efk-compose.png" width="700" />
    </a><figcaption class="image-caption">å•Ÿå‹• efk/Docker-compose.yaml</figcaption>
    </figure>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png" data-sub-html="<h2>å•Ÿå‹• nginx_php_redis/Docker-compose.yaml</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png, /images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/nginx-php-redis-compose.png" width="700" />
    </a><figcaption class="image-caption">å•Ÿå‹• nginx_php_redis/Docker-compose.yaml</figcaption>
    </figure>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png" data-sub-html="<h2>å•Ÿå‹• haproxy_sentinel/Docker-compose.yaml</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png, /images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/haproxy-sentinel-compose.png" width="700" />
    </a><figcaption class="image-caption">å•Ÿå‹• haproxy_sentinel/Docker-compose.yaml</figcaption>
    </figure>
(å•Ÿå‹• efk æ™‚è¦ç­‰ä»–è·‘å®Œï¼Œå› ç‚ºä»–éœ€è¦å•Ÿå‹•ä¸€é™£å­ï¼Œå¦‚æœé‚„æ²’ç­‰ä»–å•Ÿå‹•å®Œç•¢å°±å•Ÿå‹•ä¸‹ä¸€å€‹ï¼Œæœƒå°è‡´ fluentd çš„ fluentd-address å°šæœªè¨­å®šå¥½ï¼Œå°è‡´å•Ÿå‹•éŒ¯èª¤)</p>
<br>
<p>é€™æ™‚å€™å¯ä»¥ä½¿ç”¨ç€è¦½å™¨æœå°‹ä»¥ä¸‹ç¶²å€ï¼š</p>
<ul>
<li><code>test.com:5601</code>ï¼šKibana GUI é é¢ã€‚</li>
</ul>
<br>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/gui.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/gui.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/gui.png" data-sub-html="<h2>kibana è¨­å®š</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/gui.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/gui.png, /images/docker-compose-redis-sentinel-haproxy-efk/gui.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/gui.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/gui.png" width="1000" />
    </a><figcaption class="image-caption">kibana è¨­å®š</figcaption>
    </figure>
<p>å¦‚æœé€£ç·šæˆåŠŸé€²ä¾†ï¼Œå°±ä»£è¡¨æˆ‘å€‘æœ‰å®‰è£å¥½ Elasticsearch ä»¥åŠ kibanaï¼Œé‚£æˆ‘å€‘ä¾†åšä¸€äº›è¨­å®šï¼Œè®“æˆ‘å€‘å¯ä»¥åœ¨ kibana ä¸Šé¢çœ‹åˆ° logã€‚</p>
<p>å…ˆé»é¸å·¦é‚Šçš„æ¬„ä½ï¼Œé»é¸ &ldquo;Stack Management&rdquo; ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰çš„ kibana çš„ç‰ˆæœ¬ï¼Œå†é»é¸å·¦é‚Šçš„ &ldquo;Kibana &gt; Date Views&rdquo;ï¼š</p>
<br>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/kibana.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/kibana.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/kibana.png" data-sub-html="<h2>kibana è¨­å®š</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/kibana.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/kibana.png, /images/docker-compose-redis-sentinel-haproxy-efk/kibana.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/kibana.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/kibana.png" width="1000" />
    </a><figcaption class="image-caption">kibana è¨­å®š</figcaption>
    </figure>
<p>ç„¶å¾Œæœƒè·³å‡ºä¸€å€‹è¦–çª—é»é¸ &ldquo;Create data view&rdquo;ï¼Œåœ¨ name æ¬„ä½è¼¸å…¥ fluentd* (å³å´æœ‰ fluentd åŠ æ™‚é–“ï¼Œä»£è¡¨æˆ‘å€‘æ¥ fluentd æœ‰æˆåŠŸ)ï¼ŒæŒ‰ä¸‹ &ldquo;Create data view&rdquo;</p>
<br>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png" data-sub-html="<h2>kibana è¨­å®š</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png, /images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd.png" width="1000" />
    </a><figcaption class="image-caption">kibana è¨­å®š</figcaption>
    </figure>
<p>æ¥è‘—é»é¸å·¦å´çš„æ¬„ä½ï¼Œé»é¸ &ldquo;Analytics &gt; Discover&rdquo; ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘å€‘ç›®å‰æ‰€æœ‰çš„ log å›‰ï¼</p>
<br>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png" data-sub-html="<h2>kibana è¨­å®š</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png, /images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/fluentd-1.png" width="1000" />
    </a><figcaption class="image-caption">kibana è¨­å®š</figcaption>
    </figure>
<figure><a class="lightgallery" href="/images/docker-compose-redis-sentinel-haproxy-efk/log.png" title="/images/docker-compose-redis-sentinel-haproxy-efk/log.png" data-thumbnail="/images/docker-compose-redis-sentinel-haproxy-efk/log.png" data-sub-html="<h2>kibana Analytics &gt; Discover</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/docker-compose-redis-sentinel-haproxy-efk/log.png"
            data-srcset="/images/docker-compose-redis-sentinel-haproxy-efk/log.png, /images/docker-compose-redis-sentinel-haproxy-efk/log.png 1.5x, /images/docker-compose-redis-sentinel-haproxy-efk/log.png 2x"
            data-sizes="auto"
            alt="/images/docker-compose-redis-sentinel-haproxy-efk/log.png" width="1000" />
    </a><figcaption class="image-caption">kibana Analytics &gt; Discover</figcaption>
    </figure>
<br>
<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>
<p><a href="https://www.elastic.co/" target="_blank" rel="noopener noreffer">elastic å®˜ç¶²</a></p>
<p><a href="https://www.fluentd.org/" target="_blank" rel="noopener noreffer">fluentd å®˜ç¶²</a></p>
<p><a href="https://stackoverflow.com/questions/71155142/build-the-efk-system-used-for-simulating-logging-server-on-docker" target="_blank" rel="noopener noreffer">Build the EFK system used for simulating logging server on Docker</a></p>
<p><a href="https://wsgzao.github.io/post/efk/" target="_blank" rel="noopener noreffer">é–‹æºæ—¥èªŒç®¡ç†æ–¹æ¡ˆELK å’ŒEFK çš„å€åˆ¥</a></p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info"><div class="post-info-tag"><span><a href="/tags/efk/">EFK</a>
                </span><span><a href="/tags/haproxy/">HAProxy</a>
                </span><span><a href="/tags/redis/">Redis</a>
                </span><span><a href="/tags/docker/">Docker</a>
                </span><span><a href="/tags/sentinel/">Sentinel</a>
                </span><span><a href="/tags/%E8%B2%A0%E8%BC%89%E5%B9%B3%E8%A1%A1/">è² è¼‰å¹³è¡¡</a>
                </span><span><a href="/tags/%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F/">å“¨å…µæ¨¡å¼</a>
                </span><span><a href="/tags/%E5%AF%A6%E4%BD%9C/">å¯¦ä½œ</a>
                </span></div><div class="post-info-line"><div class="post-info-mod">
                <span>æ›´æ–°æ–¼ 2022-04-28&nbsp;<a class="git-hash" href="https://github.com/880831ian/blog/commit/983e290152e5b1ca3377ea54076ed157ca6de9c3" target="_blank" title="committed&nbsp;by&nbsp;ian_zhuang(880831ian@gmail.com)&nbsp;983e2901:&nbsp;# æ–°å¢ EFK">
                            <i class="fas fa-hashtag fa-fw"></i>983e2901</a></span>
            </div><div class="post-info-mod"><span>
                            <a class="link-to-markdown" href="/docker-compose-redis-sentinel-haproxy-efk/index.md" target="_blank">é–±è®€åŸå§‹æ–‡æª”</a>
                        </span><span>
                        &nbsp;|&nbsp;
                        <a class="link-to-markdown" href="https://github.com/880831ian/blog/tree/main/content/posts/docker-compose-redis-sentinel-haproxy-efk/index.zh-tw.md" target="_blank">Improve Article</a>
                    </span></div>
        </div><div class="post-info-share">
            <span><a href="javascript:void(0);" title="åˆ†äº«åˆ° Twitter" data-sharer="twitter" data-url="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/" data-title="ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)" data-hashtags="EFK,HAProxy,Redis,Docker,Sentinel,è² è¼‰å¹³è¡¡,å“¨å…µæ¨¡å¼,å¯¦ä½œ"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Facebook" data-sharer="facebook" data-url="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/" data-hashtag="EFK"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Linkedin" data-sharer="linkedin" data-url="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Reddit" data-sharer="reddit" data-url="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Line" data-sharer="line" data-url="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/" data-title="ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)"><i class="fab fa-line fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° å¾®åš" data-sharer="weibo" data-url="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/" data-title="ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="åˆ†äº«åˆ° Skype" data-sharer="skype" data-url="https://blog.pin-yi.me/docker-compose-redis-sentinel-haproxy-efk/" data-title="ç”¨ EFK æ”¶é›†å®¹å™¨æ—¥èªŒ (HAProxyã€Redis Sentinelã€Docker-compose)"><i class="fab fa-skype fa-fw"></i></a></span>
        </div></div><div class="post-nav"><a href="/glamping/" class="prev" rel="prev" title="ã€è±ªè¯éœ²ç‡Ÿã€‘å®œèµ·å»éœ²ç‡ŸVLOG"><i class="fas fa-angle-left fa-fw"></i>Previous Post</a>
            <a href="/k8s/" class="next" rel="next" title="Kubernetes (K8s) ä»‹ç´¹ - åŸºæœ¬">Next Post<i class="fas fa-angle-right fa-fw"></i></a></div></div>
</div><div id="comments" class="single-card"><div id="disqus_thread"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main>
            <footer class="footer"><div class="footer-container"><div class="footer-line">æ­¤ Blog å¤šæ•¸ç¨‹å¼æ–‡ç« éƒ½æ˜¯åƒè€ƒç¶²è·¯å¤§ç¥ï¼ŒåŠ ä¸Šè‡ªå·±çš„è¦‹è§£èˆ‡å¯¦ä½œå…§å®¹ç·¨å¯«è€Œæˆçš„ç­†è¨˜ï¼Œè‹¥æœ‰ä¾µæ¬Šï¼Œè«‹è¯ç¹«æˆ‘ã€‚</div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://pin-yi.me">PinYi</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
</div>
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker
        .register('/sw.min.js?version=1.0.1', { scope: '/' })
        .then(() => {
            console.info('PinYi\u00A0Service Worker Registered');
        }, err => console.error('PinYi\u00A0Service Worker registration failed: ', err));

    navigator.serviceWorker
        .ready
        .then(() => {
            console.info('PinYi\u00A0Service Worker Ready');
        });
}
</script>
</footer>
        </div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é ‚éƒ¨">
                <i class="fas fa-chevron-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è©•è«–">
                <i class="fas fa-comment-alt fa-fw"></i>
            </a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.1-beta.0/dist/css/lightgallery.min.css"><script src="https://pin-yi.disqus.com/embed.js" defer></script><script src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.0/dist/autocomplete.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script src="/lib/lunr/lunr.stemmer.support.min.js"></script><script src="/lib/lunr/lunr.zh.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.1-beta.0/dist/js/lightgallery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.1/sharer.min.js"></script><script>window.config={"code":{"copyTitle":"è¤‡è£½åˆ°å‰ªè²¼æ¿","maxShownLines":120},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ‰¾ä¸åˆ°ä½ è¼¸å…¥çš„è³‡æ–™ğŸ¥²","snippetLength":50,"type":"lunr"}};</script><script src="/js/theme.min.js"></script></body></html>
